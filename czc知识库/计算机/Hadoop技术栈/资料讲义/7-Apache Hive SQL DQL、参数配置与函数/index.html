<!doctype html>
<html lang="zh-CN">
<head>
<title>7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script async type="module">import mermaid from"https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs"</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-sv0slik/5O0JIPdLBCR2A3XDg/1U3WuDEheZfI/DI5n8Yqc3h5kjrnr46FGBNiUAJF7rE4LHKwQ/SoSLRKAxEA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script async src="https://cdn.jsdelivr.net/npm/lucide@0.115.0/dist/umd/lucide.min.js"></script>
<script>window.addEventListener("load",(()=>{document.querySelectorAll(".callout").forEach((e=>{const t=getComputedStyle(e).getPropertyValue("--callout-icon"),l=t&&t.trim().replace(/^lucide-/,"");if(l){const t=e.querySelector(".callout-title");if(t){const e=document.createElement("div"),c=document.createElement("i");e.appendChild(c),c.setAttribute("icon-name",l),e.setAttribute("class","callout-icon"),t.insertBefore(e,t.firstChild)}}})),lucide.createIcons(),Array.from(document.querySelectorAll(".callout.is-collapsible")).forEach((e=>{e.querySelector(".callout-title").addEventListener("click",(t=>{e.classList.contains("is-collapsed")?e.classList.remove("is-collapsed"):e.classList.add("is-collapsed")}))}))}))</script>
<script async src="https://fastly.jsdelivr.net/npm/force-graph@1.43.0/dist/force-graph.min.js"></script>
<script async src="https://fastly.jsdelivr.net/npm/@alpinejs/persist@3.11.1/dist/cdn.min.js"></script>
<script src="https://fastly.jsdelivr.net/npm/alpinejs@3.11.1/dist/cdn.min.js" async></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer" async>
<script src="https://fastly.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer" async></script>
<link href="/styles/digital-garden-base.css" rel="stylesheet">
<link href="/styles/obsidian-base.css" rel="stylesheet">
<link href="/styles/_theme.74516f71.css" rel="stylesheet">
<link href="/styles/custom-style.css" rel="stylesheet">
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.webmanifest">
<style></style>
<style></style>
</head>
<body class="theme-light markdown-preview-view markdown-rendered markdown-preview-section css-settings-manager mod-windows is-frameless is-maximized is-hidden-frameless is-focused obsidian-app theme-light show-inline-title show-ribbon show-view-header css-settings-manager theme-default line-style-solid folder-default blockquote-normal callout-normal checkbox-default tag-default link-default heading-default responsive-tile-height oz-show-all-num">
<nav class="navbar">
<div class="navbar-inner">
<a href="/" style="text-decoration:none">
<h1 style="margin:15px!important">czc&#39;s digital garden</h1>
</a>
</div>
<div class="search-button align-icon" onclick="toggleSearch()">
<span class="search-icon">
<i icon-name="search"></i>
</span>
<span class="search-text">
<span>Search</span>
<span style="font-size:.6rem;padding:2px 2px 0 6px;text-align:center;transform:translateY(4px)" class="search-keys">
CTRL + K
</span>
</span>
</div>
</nav>
<div class="search-container" id="globalsearch" onclick="toggleSearch()">
<div class="search-box">
<input type="search" id="term" placeholder="Start typing...">
<div id="search-results"></div>
<footer class="search-box-footer">
<div class="navigation-hint">
<span>Enter to select</span>
</div>
<div class="navigation-hint align-icon">
<i icon-name="arrow-up" aria-hidden="true"></i>
<i icon-name="arrow-down" aria-hidden="true"></i>
<span>to navigate</span>
</div>
<div class="navigation-hint">
<span>ESC to close</span>
</div>
</footer>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js"></script>
<script>document.addEventListener("DOMContentLoaded",init,!1),document.addEventListener("DOMContentLoaded",setCorrectShortcut,!1),window.toggleSearch=function(){document.getElementById("globalsearch").classList.contains("active")?document.getElementById("globalsearch").classList.remove("active"):(document.getElementById("globalsearch").classList.add("active"),document.getElementById("term").focus())},window.toggleTagSearch=function(e){console.log(e.textContent);const t=e.textContent;t&&(window.document.getElementById("term").value=t.trim(),window.toggleSearch(),window.search())};const loadingSvg='\n    <svg width="100" height="100" viewBox="0 0 45 45" xmlns="http://www.w3.org/2000/svg" stroke="#fff">\n      <g fill="none" fill-rule="evenodd" transform="translate(1 1)" stroke-width="2">\n          <circle cx="22" cy="22" r="6" stroke-opacity="0">\n              <animate attributeName="r"\n                   begin="1.5s" dur="3s"\n                   values="6;22"\n                   calcMode="linear"\n                   repeatCount="indefinite" />\n              <animate attributeName="stroke-opacity"\n                   begin="1.5s" dur="3s"\n                   values="1;0" calcMode="linear"\n                   repeatCount="indefinite" />\n              <animate attributeName="stroke-width"\n                   begin="1.5s" dur="3s"\n                   values="2;0" calcMode="linear"\n                   repeatCount="indefinite" />\n          </circle>\n          <circle cx="22" cy="22" r="6" stroke-opacity="0">\n              <animate attributeName="r"\n                   begin="3s" dur="3s"\n                   values="6;22"\n                   calcMode="linear"\n                   repeatCount="indefinite" />\n              <animate attributeName="stroke-opacity"\n                   begin="3s" dur="3s"\n                   values="1;0" calcMode="linear"\n                   repeatCount="indefinite" />\n              <animate attributeName="stroke-width"\n                   begin="3s" dur="3s"\n                   values="2;0" calcMode="linear"\n                   repeatCount="indefinite" />\n          </circle>\n          <circle cx="22" cy="22" r="8">\n              <animate attributeName="r"\n                   begin="0s" dur="1.5s"\n                   values="6;1;2;3;4;5;6"\n                   calcMode="linear"\n                   repeatCount="indefinite" />\n          </circle>\n      </g>\n  </svg>';function debounce(e,t,n){var a;return function(){var r=this,i=arguments,c=n&&!a;clearTimeout(a),a=setTimeout((function(){a=null,n||e.apply(r,i)}),t),c&&e.apply(r,i)}}function setCorrectShortcut(){navigator.platform.toUpperCase().indexOf("MAC")>=0&&document.querySelectorAll(".search-keys").forEach((e=>e.innerHTML="âŒ˜ + K"))}function createIndex(e){const t=e=>e.toLowerCase().split(/([^a-z]|[^\x00-\x7F])/),n=new FlexSearch.Document({cache:!0,charset:"latin:extra",optimize:!0,index:[{field:"content",tokenize:"reverse",encode:t},{field:"title",tokenize:"forward",encode:t},{field:"tags",tokenize:"forward",encode:t}]});return e.forEach(((e,t)=>{n.add({id:t,title:e.title,content:e.content,tags:e.tags})})),n}async function init(){let e=!0;if(localStorage.getItem("searchIndex")){let{date:t,docs:n}=JSON.parse(localStorage.getItem("searchIndex"));if("2025-06-12T11:25:24.315Z"===t){e=!1;let t=createIndex(n);window.docs=n,window.index=t}}if(e){let e=await(await fetch("/searchIndex.json?v=2025-06-12T11:25:24.315Z")).json(),t=createIndex(e);localStorage.setItem("searchIndex",JSON.stringify({date:"2025-06-12T11:25:24.315Z",docs:e})),window.docs=e,window.index=t}document.addEventListener("keydown",(e=>{if((e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),toggleSearch()),"Escape"===e.key&&document.getElementById("globalsearch").classList.remove("active"),document.getElementById("globalsearch").classList.contains("active")){if("ArrowDown"===e.key){e.preventDefault();let t=document.querySelector(".searchresult.active");t?(t.classList.remove("active"),t.nextElementSibling?t.nextElementSibling.classList.add("active"):document.querySelector(".searchresult").classList.add("active")):document.querySelector(".searchresult").classList.add("active");let n=document.querySelector(".searchresult.active");n&&n.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}if("ArrowUp"===e.key){e.preventDefault();let t=document.querySelector(".searchresult.active");t?(t.classList.remove("active"),t.previousElementSibling?t.previousElementSibling.classList.add("active"):document.querySelectorAll(".searchresult").forEach((e=>{e.nextElementSibling||e.classList.add("active")}))):document.querySelectorAll(".searchresult").forEach((e=>{e.nextElementSibling&&e.classList.add("active")}));let n=document.querySelector(".searchresult.active");n&&n.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}if("Enter"===e.key){e.preventDefault();let t=document.querySelector(".searchresult.active");t&&(window.location.href=t.querySelector("a").href)}}}));const t=debounce(search,200,!1);field=document.querySelector("#term"),field.addEventListener("keydown",(e=>{"ArrowDown"!==e.key&&"ArrowUp"!==e.key&&t()})),resultsDiv=document.querySelector("#search-results");const n=new URL(location.href).searchParams;n.get("q")&&(field.setAttribute("value",n.get("q")),toggleSearch(),search())}async function search(){let e=field.value.trim();if(!e)return;if(e==lastSearch)return;console.log(`search for ${e}`),window.lastSearch=e,resultsDiv.innerHTML=loadingSvg;let t=offlineSearch(e),n="";if(!t.length){let t=document.createElement("p");return t.innerText=`No results for "${e}"`,resultsDiv.innerHTML="",void resultsDiv.appendChild(t)}n+='<div style="max-width:100%;">',t.forEach((e=>{e.tags&&e.tags.length>0?n+=`<div class="searchresult">\n                    <a class="search-link" href="${e.url}">${e.title}</a>\n                    <div onclick="window.location='${e.url}'">\n                        <div class="header-meta">\n                            <div class="header-tags">\n                                ${e.tags.map((e=>'<a class="tag" href="JavaScript:Void(0);">#'+e+"</a>")).join("")}\n                            </div>\n                        </div>\n                        ${e.content}\n                    </div>\n                </div>`:n+=`<div class="searchresult">\n                    <a class="search-link" href="${e.url}">${e.title}</a>\n                    <div onclick="window.location='${e.url}'">\n                        ${e.content}\n                    </div>\n                </div>`})),n+="</div>",resultsDiv.innerHTML=n}function truncate(e,t){return(e=e.replaceAll(/<[^>]*>/g,"")).length<t?e:e.substring(0,t-3)+"..."}function offlineSearch(e){let t=window.docs,n="#"===e[0]&&e.length>1?index.search(e.substring(1),[{field:"tags"}]):index.search(e,[{field:"title",limit:5},{field:"content",weight:10}]);const a=e=>{const t=n.filter((t=>t.field===e));return 0===t.length?[]:[...t[0].result]};return[...new Set([...a("title"),...a("content"),...a("tags")])].map((e=>{let n=t[e];return n.content=truncate(n.content,400),n.tags=n.tags.filter((e=>"gardenEntry"!=e&&"note"!=e)),n}))}window.lastSearch=""</script>
<main class="content cm-s-obsidian">
<header>
<h1 data-note-icon="">7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°</h1>
<div class="header-meta">
<div class="header-tags">
</div>
<div class="timestamps"><div><i icon-name="calendar-plus"></i> <span class="human-date" data-date="2025-06-09T10:30:37.823+08:00"></span></div><div><i icon-name="calendar-clock"></i> <span class="human-date" data-date="2025-04-13T17:30:43.000+08:00"></span></div></div></div>
</header>
<h3 id="hadoop-day07-apache-hive-sql-dql" tabindex="-1">hadoopç¦»çº¿day07-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°</h3>
<hr>
<h4 id="ä»Šæ—¥è¯¾ç¨‹å­¦ä¹ ç›®æ ‡" tabindex="-1">ä»Šæ—¥è¯¾ç¨‹å­¦ä¹ ç›®æ ‡</h4>
<pre><code class="language-shell"><a class="tag" onclick="toggleTagSearch(this)" data-content="#æŒæ¡HiveQL">#æŒæ¡HiveQL</a> DQLæŸ¥è¯¢è¯­å¥
	åŸºç¡€selectæŸ¥è¯¢è¯­æ³•å’ŒMySQLä¸€æ · 
	ä¾§é‡è®°å¿†ä¸ä¸€æ ·çš„ï¼ˆè§ä¸‹é¢å¤§çº²ï¼‰
<a class="tag" onclick="toggleTagSearch(this)" data-content="#æŒæ¡HiveSQL">#æŒæ¡HiveSQL</a> joinæŸ¥è¯¢
	é‡ç‚¹æ˜¯å†…å…³è”ã€å·¦å…³è”
<a class="tag" onclick="toggleTagSearch(this)" data-content="#å­¦ä¼šHive">#å­¦ä¼šHive</a> shellå‘½ä»¤è¡Œä¸å‚æ•°é…ç½®
<a class="tag" onclick="toggleTagSearch(this)" data-content="#ç†è§£å‡½æ•°åˆ†ç±»æ ‡å‡†">#ç†è§£å‡½æ•°åˆ†ç±»æ ‡å‡†</a>(UDFã€UDTFã€UDAF)
	æ ¹æ®å‡½æ•°è¾“å…¥å’Œè¾“å‡ºçš„è¡Œæ•°
		ä¸€è¿›ä¸€å‡º
		ä¸€è¿›å¤šå‡º
		å¤šè¿›ä¸€å‡º
<a class="tag" onclick="toggleTagSearch(this)" data-content="#æŒæ¡å¸¸ç”¨å‡½æ•°çš„ä½¿ç”¨">#æŒæ¡å¸¸ç”¨å‡½æ•°çš„ä½¿ç”¨</a>
	è§å¤šè¯†å¹¿ï¼Œå¤šç”¨å¤šä¼šï¼Œä¸ç”¨å°±å¿˜
</code></pre>
<h4 id="ä»Šæ—¥è¯¾ç¨‹å†…å®¹å¤§çº²" tabindex="-1">ä»Šæ—¥è¯¾ç¨‹å†…å®¹å¤§çº²</h4>
<pre><code class="language-shell"><a class="tag" onclick="toggleTagSearch(this)" data-content="#1ã€PyCharm|IDEA">#1ã€PyCharm|IDEA</a> Hiveæ’ä»¶
	æ”¯æŒHQLè¯­æ³•ï¼Œä½œä¸ºå®¢æˆ·ç«¯è®¿é—®HS2
<a class="tag" onclick="toggleTagSearch(this)" data-content="#2ã€HQL">#2ã€HQL</a> DQL æ•°æ®æŸ¥è¯¢è¯­è¨€
	cluster by
	distribute by+sort by
	order by
	union
	CTE
	Hiveçš„joinè¯­æ³•
<a class="tag" onclick="toggleTagSearch(this)" data-content="#3ã€hiveçš„shellå‘½ä»¤è¡Œå’Œå‚æ•°é…ç½®æ–¹å¼">#3ã€hiveçš„shellå‘½ä»¤è¡Œå’Œå‚æ•°é…ç½®æ–¹å¼</a>
<a class="tag" onclick="toggleTagSearch(this)" data-content="#4ã€Hiveçš„å‡½æ•°">#4ã€Hiveçš„å‡½æ•°</a>
	å‡½æ•°åˆ†ç±»ï¼šå†…ç½®å‡½æ•°ã€ç”¨æˆ·å®šä¹‰å‡½æ•°
	UDFã€UDTFã€UDAF
</code></pre>
<hr>
<h4 id="01-hive-sql-dql" tabindex="-1">çŸ¥è¯†ç‚¹01ï¼šHive SQL--DQL--åŸºç¡€æŸ¥è¯¢è¯­å¥åŠå…¶æ³¨æ„äº‹é¡¹</h4>
<p>1.1ã€selectè¯­æ³•æ ‘</p>
<pre><code class="language-sql">SELECT [ALL | DISTINCT] select_expr, select_expr, ...
FROM table_reference
JOIN table_other ON expr
[WHERE where_condition]
[GROUP BY col_list [HAVING condition]]
[CLUSTER BY col_list
| [DISTRIBUTE BY col_list] [SORT BY| ORDER BY col_list]
]
[LIMIT number]
</code></pre>
<ul>
<li>
<p>ä¸ç®¡æ˜¯å†™selectè¯­å¥è¿˜æ˜¯çœ‹selectè¯­å¥ï¼Œ==<strong>fromå…³é”®å­—</strong>==åŠåé¢çš„è¡¨æ˜¯æœ€é‡è¦ï¼›</p>
</li>
<li>
<p>å…¶åé¢çš„è¡¨å¯èƒ½æ˜¯ä¸€å¼ çœŸå®ç‰©ç†å­˜åœ¨çš„è¡¨ï¼Œä¹Ÿå¯èƒ½æ˜¯è™šæ‹Ÿçš„è¡¨ï¼ˆæŸ¥è¯¢çš„ç»“æœ è§†å›¾viewï¼‰</p>
</li>
<li>
<p>selectåŸºç¡€è¯­æ³•</p>
</li>
</ul>
<h5 id="sql" tabindex="-1">â­â­SQLçš„é‡ç‚¹â­â­</h5>
<ul>
<li><strong><mark>whereè¯­å¥ä¸­ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°ï¼Ÿ</mark></strong>
<ul>
<li><strong>å› ä¸ºèšåˆå‡½æ•°è¦ä½¿ç”¨å®ƒçš„å‰ææ˜¯ç»“æœé›†å·²ç»ç¡®å®šã€‚è€Œwhereå­å¥è¿˜å¤„äºâ€œç¡®å®šâ€ç»“æœé›†çš„è¿‡ç¨‹ä¸­ï¼Œå› è€Œä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°ã€‚</strong></li>
</ul>
</li>
<li><strong><mark>Havingå’Œwhereçš„åŒºåˆ«ï¼Ÿ</mark></strong>
<ul>
<li>havingåœ¨åˆ†ç»„åå¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œèƒ½ä½¿ç”¨èšåˆå‡½æ•°ï¼Œwhereåœ¨åˆ†ç»„å‰å¯¹æ•°æ®è¿‡æ»¤ï¼Œä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°</li>
<li><strong>HAVINGå­å¥å¯ä»¥è®©æˆ‘ä»¬ç­›é€‰åˆ†ç»„åçš„å„ç»„æ•°æ®,å¹¶ä¸”å¯ä»¥åœ¨Havingä¸­ä½¿ç”¨èšåˆå‡½æ•°ï¼Œå› ä¸ºæ­¤æ—¶whereï¼Œgroup byå·²ç»æ‰§è¡Œç»“æŸï¼Œç»“æœé›†å·²ç»ç¡®å®šã€‚</strong></li>
</ul>
</li>
<li><strong><mark>group byè¯­æ³•ä¸­çš„æŸ¥è¯¢å­—æ®µçš„é™åˆ¶ï¼Ÿä¸ºä»€ä¹ˆè¦æ±‚æ˜¯åˆ†ç»„å­—æ®µæˆ–è€…æ˜¯èšåˆå‡½æ•°åº”ç”¨çš„å­—æ®µ</mark></strong>
<ul>
<li>ä¸€ä¸ªåˆ†ç»„ä¸­éåˆ†ç»„å­—æ®µå’Œèšåˆå‡½æ•°å­—æ®µä¼šæœ‰å¤šä¸ªå€¼ï¼Œä½†åœ¨æŸ¥è¯¢åæ¯ç»„åªå ä¸€è¡Œï¼Œæ‰€ä»¥å†²çªæ— æ³•æ˜¾ç¤º</li>
<li>çœæµï¼š<strong>é¿å…å‡ºç°ä¸€ä¸ªå­—æ®µå¤šä¸ªå€¼çš„æ­§ä¹‰</strong></li>
</ul>
</li>
<li><strong><mark>æ¢³ç†æ‰§è¡Œé¡ºåºï¼Ÿ</mark></strong>
<ul>
<li>é¡ºåºï¼šfromã€‰whereã€‰groupï¼ˆå«èšåˆï¼‰&gt;having&gt;orderã€‰selectï¼›</li>
</ul>
</li>
</ul>
<hr>
<h4 id="02-hive-sql-dql-cluster-distribute-sort" tabindex="-1">çŸ¥è¯†ç‚¹02ï¼šHive SQL--DQL--é«˜é˜¶æŸ¥è¯¢--clusterã€distributeã€sort</h4>
<p><mark>CLUSTER BY åˆ†æ¡¶æŸ¥è¯¢</mark></p>
<blockquote>
<p>ä¸ºäº†æ¢ç©¶åº•å±‚ç»†èŠ‚ï¼Œå»ºè®®ä½¿ç”¨beelineå®¢æˆ·ç«¯ç»ƒä¹  æ–¹é¢æŸ¥çœ‹æŸ¥è¯¢è¿‡ç¨‹æ—¥å¿—ã€‚</p>
</blockquote>
<ul>
<li>
<p>è¯­æ³•</p>
<pre><code class="language-sql">select * from student;  --æ™®é€šæŸ¥è¯¢
select * from student cluster by num; --åˆ†æ¡¶æŸ¥è¯¢ æ ¹æ®å­¦ç”Ÿç¼–å·è¿›è¡Œåˆ†æ¡¶æŸ¥è¯¢
</code></pre>
<p>Qï¼šåˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Ÿ åˆ†çš„è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ<br>
- åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†å–å†³äºreducetaskä¸ªæ•°<br>
- åˆ†çš„è§„åˆ™å’Œåˆ†æ¡¶è¡¨çš„è§„åˆ™ä¸€æ · hashfunc(å­—æ®µ) % reducetaskä¸ªæ•°</p>
</li>
<li>
<p>reducetaskä¸ªæ•°æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ reducetaskä¸ªæ•°å°±å†³å®šäº†æœ€ç»ˆæ•°æ®åˆ†ä¸ºå‡ æ¡¶ã€‚</p>
<pre><code class="language-sql">--å¦‚æœç”¨æˆ·æ²¡æœ‰è®¾ç½®,ä¸æŒ‡å®šreduce taskä¸ªæ•°ã€‚åˆ™hiveæ ¹æ®è¡¨è¾“å…¥æ•°æ®é‡è‡ªå·±è¯„ä¼°
--æ—¥å¿—æ˜¾ç¤ºï¼šNumber of reduce tasks not specified. Estimated from input data size: 1
select * from student cluster by num;

--æ‰‹åŠ¨è®¾ç½®reduce taskä¸ªæ•°
--æ—¥å¿—æ˜¾ç¤ºï¼šNumber of reduce tasks not specified. Defaulting to jobconf value of: 2
set mapreduce.job.reduces =2;
select * from student cluster by num;
----åˆ†æ¡¶æŸ¥è¯¢çš„ç»“æœçœŸçš„æ ¹æ®reduce tasksä¸ªæ•°åˆ†ä¸ºäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¹¶ä¸”æ¯ä¸ªéƒ¨åˆ†ä¸­è¿˜æ ¹æ®äº†å­—æ®µè¿›è¡Œäº†æ’åºã€‚

--æ€»ç»“ï¼šcluster by xx  åˆ†ä¸”æ’åºçš„åŠŸèƒ½
	  åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ† å–å†³äºreducetaskä¸ªæ•°
	  æ’åºåªèƒ½æ˜¯æ­£åº ç”¨æˆ·æ— æ³•æ”¹å˜
	   
--éœ€æ±‚ï¼šæŠŠstudentè¡¨æ•°æ®æ ¹æ®numåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¸­æ ¹æ®å¹´é¾„ageå€’åºæ’åºã€‚	
set mapreduce.job.reduces =2;
select  * from student cluster by num order by age desc;
select  * from student cluster by num sort by age desc;
--FAILED: SemanticException 1:50 Cannot have both CLUSTER BY and SORT BY clauses

</code></pre>
</li>
</ul>
<p><mark>DISTRIBUTE BY+SORT BY</mark></p>
<ul>
<li>
<p>åŠŸèƒ½ï¼šç›¸å½“äºæŠŠcluster byçš„åŠŸèƒ½ä¸€åˆ†ä¸ºäºŒã€‚</p>
<ul>
<li>distribute byåªè´Ÿè´£åˆ†;</li>
<li>sort byåªè´Ÿè´£åˆ†ä¹‹åçš„æ¯ä¸ªéƒ¨åˆ†æ’åºã€‚</li>
<li>å¹¶ä¸”åˆ†å’Œæ’åºçš„å­—æ®µå¯ä»¥ä¸ä¸€æ ·ã€‚</li>
</ul>
<pre><code class="language-sql">--å½“åé¢åˆ†å’Œæ’åºçš„å­—æ®µæ˜¯åŒä¸€ä¸ªå­—æ®µ åŠ èµ·æ¥å°±ç›¸ç­‰äºcluster by
CLUSTER BY(åˆ†ä¸”æ’åº) = DISTRIBUTE BYï¼ˆåˆ†ï¼‰+SORT BYï¼ˆæ’åºï¼‰ 

--ä¸‹é¢ä¸¤ä¸ªåŠŸèƒ½ä¸€æ ·çš„
select  * from student cluster by num;
select  * from student distribute by num sort by num;

--æœ€ç»ˆå®ç°
select  * from student distribute by num sort by age desc;
</code></pre>
</li>
<li>
<p>ORDER BY</p>
<pre><code class="language-sql">--é¦–å…ˆæˆ‘ä»¬è®¾ç½®ä¸€ä¸‹reducetaskä¸ªæ•°ï¼Œéšä¾¿è®¾ç½®
--æ ¹æ®ä¹‹å‰çš„æ¢è®¨ï¼Œè²Œä¼¼ç”¨æˆ·è®¾ç½®å‡ ä¸ªï¼Œç»“æœå°±æ˜¯å‡ ä¸ªï¼Œä½†æ˜¯å®é™…æƒ…å†µå¦‚ä½•å‘¢ï¼Ÿ
set mapreduce.job.reduces =2;
select  * from student order by age desc;

--æ‰§è¡Œä¸­æ—¥å¿—æ˜¾ç¤º
Number of reduce tasks determined at compile time: 1 --ä¸æ˜¯è®¾ç½®äº†ä¸º2å— 

--åŸå› ï¼šorder byæ˜¯å…¨å±€æ’åºã€‚å…¨å±€æ’åºæ„å‘³ç€æ•°æ®åªèƒ½è¾“å‡ºåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚å› æ­¤ä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªreducetask.
--åœ¨order byå‡ºç°çš„æƒ…å†µä¸‹ï¼Œä¸ç®¡ç”¨æˆ·è®¾ç½®å‡ ä¸ªreducetask,åœ¨ç¼–è¯‘æ‰§è¡ŒæœŸé—´éƒ½ä¼šå˜ä¸ºä¸€ä¸ªï¼Œæ»¡è¶³å…¨å±€ã€‚
</code></pre>
<ul>
<li>order by å’Œsort by
<ul>
<li>order byè´Ÿè´£<mark>å…¨å±€æ’åº</mark> æ„å‘³ç€æ•´ä¸ªmrä½œä¸šåªæœ‰ä¸€ä¸ªreducetask ä¸ç®¡ç”¨æˆ·è®¾ ç½®å‡ ä¸ª ç¼–è¯‘æœŸé—´hiveéƒ½ä¼šæŠŠå®ƒè®¾ç½®ä¸º1ã€‚</li>
<li>sort byè´Ÿè´£åˆ†å®Œä¹‹å å±€éƒ¨æ’åºã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><picture src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image.png"><source media="(max-width:480px)" srcset="/img/optimized/CARahespZr-500.webp" type="image/webp">
<source media="(max-width:480px)" srcset="/img/optimized/CARahespZr-500.jpeg">
<source media="(max-width:1920px)" srcset="/img/optimized/CARahespZr-700.webp" type="image/webp"><source media="(max-width:1920px)" srcset="/img/optimized/CARahespZr-700.jpeg"><img class="" src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image.png" width=""></picture></p>
<hr>
<h4 id="03-hive-sql-dql-union" tabindex="-1">çŸ¥è¯†ç‚¹03ï¼šHive SQL--DQL--é«˜é˜¶æŸ¥è¯¢--Unionè”åˆæŸ¥è¯¢</h4>
<p>æ³¨æ„åˆå¹¶ç»†èŠ‚</p>
<p>å®Œæ•´ç‰ˆselectè¯­æ³•æ ‘</p>
<pre><code class="language-sql">[WITH CommonTableExpression (, CommonTableExpression)*]
SELECT [ALL | DISTINCT] select_expr, select_expr, ...
  FROM table_reference
  [WHERE where_condition]
  [GROUP BY col_list]
  [ORDER BY col_list]
  [CLUSTER BY col_list
    | [DISTRIBUTE BY col_list] [SORT BY col_list]
  ]
 [LIMIT [offset,] rows];
</code></pre>
<ul>
<li>unionè”åˆæŸ¥è¯¢</li>
</ul>
<blockquote>
<p>UNIONç”¨äºå°†æ¥è‡ª<mark>å¤šä¸ªSELECTè¯­å¥çš„ç»“æœåˆå¹¶ä¸ºä¸€ä¸ªç»“æœé›†</mark>ã€‚</p>
</blockquote>
<pre><code class="language-sql">--è¯­æ³•è§„åˆ™
select_statement UNION [ DISTINCT|ALL ] select_statement UNION [ALL | DISTINCT] select_statement ...;

--ä½¿ç”¨DISTINCTå…³é”®å­—ä¸ä½¿ç”¨UNIONé»˜è®¤å€¼æ•ˆæœä¸€æ ·ï¼Œéƒ½ä¼šåˆ é™¤é‡å¤è¡Œã€‚
select num,name from student_local
UNION
select num,name from student_hdfs;
--å’Œä¸Šé¢ä¸€æ ·
select num,name from student_local
UNION DISTINCT
select num,name from student_hdfs;

--ä½¿ç”¨ALLå…³é”®å­—ä¼šä¿ç•™é‡å¤è¡Œã€‚
select num,name from student_local
UNION ALL
select num,name from student_hdfs limit 2;

--å¦‚æœè¦å°†ORDER BYï¼ŒSORT BYï¼ŒCLUSTER BYï¼ŒDISTRIBUTE BYæˆ–LIMITåº”ç”¨äºå•ä¸ªSELECT
--è¯·å°†å­å¥æ”¾åœ¨æ‹¬ä½SELECTçš„æ‹¬å·å†…
SELECT num,name FROM (select num,name from student_local LIMIT 2)  subq1
UNION
SELECT num,name FROM (select num,name from student_hdfs LIMIT 3) subq2;

--å¦‚æœè¦å°†ORDER BYï¼ŒSORT BYï¼ŒCLUSTER BYï¼ŒDISTRIBUTE BYæˆ–LIMITå­å¥åº”ç”¨äºæ•´ä¸ªUNIONç»“æœ
--è¯·å°†ORDER BYï¼ŒSORT BYï¼ŒCLUSTER BYï¼ŒDISTRIBUTE BYæˆ–LIMITæ”¾åœ¨æœ€åä¸€ä¸ªä¹‹åã€‚
select num,name from student_local
UNION
select num,name from student_hdfs
order by num desc;
</code></pre>
<hr>
<h4 id="04-hive-sql-dql-cte" tabindex="-1">çŸ¥è¯†ç‚¹04ï¼šHive SQL--DQL--é«˜é˜¶æŸ¥è¯¢--CTEè¡¨è¾¾å¼</h4>
<div class="callout" data-callout="important"><div class="callout-title"><div class="callout-title-inner">Important</div></div>
<div class="callout-content">
<p>
é€šç”¨è¡¨è¡¨è¾¾å¼ï¼ˆCTEï¼‰æ˜¯ä¸€ä¸ªä¸´æ—¶ç»“æœé›†ï¼Œè¯¥ç»“æœé›†æ˜¯ä»<mark>WITHå­å¥ä¸­æŒ‡å®šçš„ç®€å•æŸ¥è¯¢</mark><br>
<mark>æ´¾ç”Ÿè€Œæ¥çš„</mark>ï¼Œè¯¥æŸ¥è¯¢ç´§æ¥åœ¨SELECTæˆ–INSERTå…³é”®å­—ä¹‹å‰ã€‚</p>
<p>é€šä¿—è§£é‡Šï¼šsqlå¼€å§‹å‰å®šä¹‰ä¸€ä¸ªSQLç‰‡æ–­ï¼Œè¯¥SQLç‰‡æ–­å¯ä»¥è¢«åç»­æ•´ä¸ªSQLè¯­å¥æ‰€ç”¨åˆ°ï¼Œå¹¶ä¸”å¯ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚</p>
</div></div>
<pre><code class="language-sql">--selectè¯­å¥ä¸­çš„CTE
with q1 as (select num,name,age from student where num = 95002)
select *
from q1;

-- fromé£æ ¼
with q1 as (select num,name,age from student where num = 95002)
from q1
select *;

-- chaining CTEs é“¾å¼
with q1 as ( select * from student where num = 95002),
     q2 as ( select num,name,age from q1)
select * from (select num from q2) a;

-- union
with q1 as (select * from student where num = 95002),
     q2 as (select * from student where num = 95004)
select * from q1 union all select * from q2;

-- ctas  â­â­â­â­â­
-- creat table as select åˆ›å»ºä¸€å¼ è¡¨æ¥è‡ªäºåé¢çš„æŸ¥è¯¢è¯­å¥  è¡¨çš„å­—æ®µä¸ªæ•° åå­— é¡ºåºå’Œæ•°æ®è¡Œæ•°éƒ½å–å†³äºæŸ¥è¯¢
-- create table t_ctas as select num,name from student limit 2;

create table s2 as
with q1 as ( select * from student where num = 95002)
select * from q1;

-- view
create view v1 as
with q1 as ( select * from student where num = 95002)
select * from q1;

select * from v1;
</code></pre>
<p>CTASè¯­æ³•<br>
<picture src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-1.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-1.png"><source media="(max-width:480px)" srcset="/img/optimized/P4JcP6Ifxb-500.webp" type="image/webp">
<source media="(max-width:480px)" srcset="/img/optimized/P4JcP6Ifxb-500.jpeg">
<source media="(max-width:1920px)" srcset="/img/optimized/P4JcP6Ifxb-700.webp" type="image/webp"><source media="(max-width:1920px)" srcset="/img/optimized/P4JcP6Ifxb-700.jpeg"><img class="" src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-1.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-1.png" width=""></picture></p>
<hr>
<h4 id="05-hive-sql-dql-join-inner-left" tabindex="-1">çŸ¥è¯†ç‚¹05ï¼šHive SQL--DQL--Joinè¯­æ³•åŠå…¶ä½¿ç”¨ï¼ˆä¾§é‡innerã€leftï¼‰</h4>
<blockquote>
<p>æ•°æ®åº“ã€Šä¸‰å¤§èŒƒå¼è®¾è®¡ã€‹</p>
</blockquote>
<pre><code class="language-sql">--ä¸ºä»€ä¹ˆåœ¨SQLç±»è¯­è¨€ä¸­æœ‰joinè¯­æ³•å‡ºç°ï¼Ÿ
åŸºäºsqlä¸šåŠ¡çš„å®é™…ä½¿ç”¨ï¼Œé’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡åˆ›å»ºä¸åŒçš„è¡¨ï¼Œæ•°æ®ä¿å­˜åœ¨ä¸åŒçš„è¡¨ä¸­ã€‚
æœ‰çš„ä¸šåŠ¡éœ€æ±‚åŸºäºå¤šä»½æ•°æ®å…±åŒç»„åˆæŸ¥è¯¢æ‰èƒ½è¿”å›ï¼ŒåŸºäºå¤šå¼ è¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥æœ‰äº†joinå…³è”æŸ¥è¯¢ã€‚
</code></pre>
<ul>
<li>
<p>è¯­æ³•æ ‘</p>
<pre><code class="language-sql">join_table:
    table_reference [INNER] JOIN table_factor [join_condition]
  | table_reference {LEFT|RIGHT|FULL} [OUTER] JOIN table_reference join_condition
  | table_reference LEFT SEMI JOIN table_reference join_condition
  | table_reference CROSS JOIN table_reference [join_condition] (as of Hive 0.10)
 
join_condition:
    ON expression
</code></pre>
</li>
<li>
<p>å…·ä½“6ç§joinæ–¹å¼ï¼Œé‡ç‚¹æŒæ¡ <mark>inner å’Œleft join</mark>ï¼ˆå·¦è¿æ¥ä»¥å·¦è¡¨ä¸ºå‡†ï¼Œå³è¡¨æœ‰æ»¡è¶³çš„åˆ™æ˜¾ç¤ºï¼Œæ²¡æœ‰åˆ™è¿”å›nullï¼‰ã€‚</p>
</li>
<li>
<p><picture src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-2.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-2.png"><source media="(max-width:480px)" srcset="/img/optimized/q4wDTSa9Wj-500.webp" type="image/webp">
<source media="(max-width:480px)" srcset="/img/optimized/q4wDTSa9Wj-500.jpeg">
<source media="(max-width:1920px)" srcset="/img/optimized/q4wDTSa9Wj-700.webp" type="image/webp"><source media="(max-width:1920px)" srcset="/img/optimized/q4wDTSa9Wj-700.jpeg"><img class="" src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-2.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-2.png" width=""></picture></p>
</li>
<li>
<p>å…¨å¤–è¿æ¥ï¼šæŠŠAå’ŒBå»æ‰é‡å¤</p>
<ul>
<li>åœ¨åŠŸèƒ½ä¸Šï¼šç­‰ä»·äºå¯¹è¿™ä¸¤ä¸ªæ•°æ®é›†åˆåˆ†åˆ«è¿›è¡Œå·¦å¤–è¿æ¥å’Œå³å¤–è¿æ¥ï¼Œç„¶åå†ä½¿ç”¨æ¶ˆå»é‡å¤è¡Œçš„æ“ä½œå°†ä¸Šè¿°ä¸¤ä¸ªç»“æœé›†åˆå¹¶ä¸ºä¸€ä¸ªç»“æœé›†ã€‚</li>
</ul>
</li>
<li>
<p>å·¦åŠå¼€è¿æ¥ï¼š</p>
<ul>
<li>æ‰§è¡Œå†…è¿æ¥ååªæ˜¾ç¤ºå·¦è¡¨çš„è®°å½•</li>
</ul>
</li>
<li>
<p>cross joinï¼šæ…ç”¨2wÃ—5w=10äº¿</p>
</li>
</ul>
<pre><code class="language-sql">--Joinè¯­æ³•ç»ƒä¹  å»ºè¡¨
drop table if exists employee_address;
drop table if exists employee_connection;
drop table if exists employee;

--table1: å‘˜å·¥è¡¨
CREATE TABLE employee(
   id int,
   name string,
   deg string,
   salary int,
   dept string
 ) row format delimited
fields terminated by ',';

--table2:å‘˜å·¥å®¶åº­ä½å€ä¿¡æ¯è¡¨
CREATE TABLE employee_address (
    id int,
    hno string,
    street string,
    city string
) row format delimited
fields terminated by ',';

--table3:å‘˜å·¥è”ç³»æ–¹å¼ä¿¡æ¯è¡¨
CREATE TABLE employee_connection (
    id int,
    phno string,
    email string
) row format delimited
fields terminated by ',';

--åŠ è½½æ•°æ®åˆ°è¡¨ä¸­
load data local inpath '/root/hivedata/employee.txt' into table employee;
load data local inpath '/root/hivedata/employee_address.txt' into table employee_address;
load data local inpath '/root/hivedata/employee_connection.txt' into table employee_connection;

select * from employee;
+--------------+----------------+---------------+------------------+----------------+
| employee.id  | employee.name  | employee.deg  | employee.salary  | employee.dept  |
+--------------+----------------+---------------+------------------+----------------+
| 1201         | gopal          | manager       | 50000            | TP             |
| 1202         | manisha        | cto           | 50000            | TP             |
| 1203         | khalil         | dev           | 30000            | AC             |
| 1204         | prasanth       | dev           | 30000            | AC             |
| 1206         | kranthi        | admin         | 20000            | TP             |
| 1201         | gopal          | manager       | 50000            | TP             |
| 1202         | manisha        | cto           | 50000            | TP             |
| 1203         | khalil         | dev           | 30000            | AC             |
| 1204         | prasanth       | dev           | 30000            | AC             |
| 1206         | kranthi        | admin         | 20000            | TP             |
+--------------+----------------+---------------+------------------+----------------+

select * from employee_address;


select * from employee_connection;

</code></pre>
<pre><code class="language-sql">--1ã€å†…è¿æ¥  inner join == join
  è¿”å›å·¦å³ä¸¤è¾¹åŒæ—¶æ»¡è¶³æ¡ä»¶çš„æ•°æ®
  
select e.*,e_a.*
from employee e inner join employee_address e_a
on e.id =e_a.id;

--ç­‰ä»·äº inner join
select e.*,e_a.*
from employee e join employee_address e_a
on e.id =e_a.id;

--ç­‰ä»·äº éšå¼è¿æ¥è¡¨ç¤ºæ³•
select e.*,e_a.*
from employee e , employee_address e_a
where e.id =e_a.id;

  
--2ã€å·¦è¿æ¥  left join  ==  left OUTER join
  å·¦è¡¨ä¸ºå‡†ï¼Œå·¦è¡¨å…¨éƒ¨æ˜¾ç¤ºï¼Œå³è¡¨ä¸ä¹‹å…³è” æ»¡è¶³æ¡ä»¶çš„è¿”å›ï¼Œä¸æ»¡è¶³æ¡ä»¶æ˜¾ç¤ºnull
  
select e.*,e_conn.*
from employee e left join employee_connection e_conn
on e.id =e_conn.id;

--ç­‰ä»·äº left outer join å·¦å¤–è¿æ¥
select e.id,e.*,e_conn.*
from employee e left outer join  employee_connection e_conn
on e.id =e_conn.id;  
  
--3ã€å³è¿æ¥  right join  ==  right OUTER join å³å¤–è¿æ¥
  å³è¡¨ä¸ºå‡†ï¼Œå³è¡¨å…¨éƒ¨æ˜¾ç¤ºï¼Œå·¦è¡¨ä¸ä¹‹å…³è” æ»¡è¶³æ¡ä»¶çš„è¿”å›ï¼Œä¸æ»¡è¶³æ¡ä»¶æ˜¾ç¤ºnull
 
select e.id,e.*,e_conn.*
from employee e right join employee_connection e_conn
on e.id =e_conn.id;

--ç­‰ä»·äº right outer join
select e.id,e.*,e_conn.*
from employee e right outer join employee_connection e_conn
on e.id =e_conn.id;

--4ã€å¤–è¿æ¥ å…¨å¤–è¿æ¥ full join == full outer join
FULL OUTER JOIN å…³é”®å­—åªè¦å·¦è¡¨ï¼ˆtable1ï¼‰å’Œå³è¡¨ï¼ˆtable2ï¼‰å…¶ä¸­ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨åŒ¹é…ï¼Œåˆ™è¿”å›è¡Œ.
FULL OUTER JOIN å…³é”®å­—ç»“åˆäº† LEFT JOIN å’Œ RIGHT JOIN çš„ç»“æœã€‚

select e.*,e_a.*
from employee e full outer join employee_address e_a
on e.id =e_a.id;
--ç­‰ä»·äº
select e.*,e_a.*
from employee e full join employee_address e_a
on e.id =e_a.id;

--5ã€å·¦åŠè¿æ¥ left semi join

select *
from employee e left semi join employee_address e_addr
on e.id =e_addr.id;

--ç›¸å½“äº inner join,ä½†æ˜¯åªè¿”å›å·¦è¡¨å…¨éƒ¨æ•°æ®ï¼Œ åªä¸è¿‡æ•ˆç‡é«˜ä¸€äº›
select e.*
from employee e inner join employee_address e_addr
on e.id =e_addr.id;

--6ã€äº¤å‰è¿æ¥cross join
å°†ä¼šè¿”å›è¢«è¿æ¥çš„ä¸¤ä¸ªè¡¨çš„ç¬›å¡å°”ç§¯ï¼Œè¿”å›ç»“æœçš„è¡Œæ•°ç­‰äºä¸¤ä¸ªè¡¨è¡Œæ•°çš„ä¹˜ç§¯ã€‚å¯¹äºå¤§è¡¨æ¥è¯´ï¼Œcross joinæ…ç”¨ã€‚
åœ¨SQLæ ‡å‡†ä¸­å®šä¹‰çš„cross joinå°±æ˜¯æ— æ¡ä»¶çš„inner joinã€‚è¿”å›ä¸¤ä¸ªè¡¨çš„ç¬›å¡å°”ç§¯,æ— éœ€æŒ‡
å®šå…³è”é”®ã€‚
åœ¨HiveSQLè¯­æ³•ä¸­ï¼Œcross join åé¢å¯ä»¥è·Ÿwhereå­å¥è¿›è¡Œè¿‡æ»¤ï¼Œæˆ–è€…onæ¡ä»¶è¿‡æ»¤ã€‚
</code></pre>
<hr>
<h4 id="06-hive-sql-dql-join" tabindex="-1">çŸ¥è¯†ç‚¹06ï¼šHive SQL--DQL--Joinè¯­æ³•æ³¨æ„äº‹é¡¹</h4>
<ul>
<li>
<p>ä¼˜åŒ–æ–¹å¼åœ¨æœ€åä¸€å¤©è°ƒä¼˜è¯¾ç¨‹ä¸­å­¦ä¹ ï¼›</p>
</li>
<li>
<p>å…è®¸ä½¿ç”¨å¤æ‚çš„è”æ¥è¡¨è¾¾å¼ï¼Œæ”¯æŒéç­‰å€¼è¿æ¥ï¼›</p>
</li>
<li>
<p>åŒä¸€æŸ¥è¯¢ä¸­å¯ä»¥è¿æ¥2ä¸ªä»¥ä¸Šçš„è¡¨ï¼›</p>
</li>
<li>
<p>å¦‚æœæ¯ä¸ªè¡¨åœ¨è”æ¥å­å¥ä¸­ä½¿ç”¨ç›¸åŒçš„åˆ—ï¼Œåˆ™Hiveå°†å¤šä¸ªè¡¨ä¸Šçš„è”æ¥è½¬æ¢ä¸ºå•ä¸ªMRä½œä¸š<picture src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-3.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-3.png"><source media="(max-width:480px)" srcset="/img/optimized/M4SifGcdUE-500.webp" type="image/webp">
<source media="(max-width:480px)" srcset="/img/optimized/M4SifGcdUE-500.jpeg">
<source media="(max-width:1920px)" srcset="/img/optimized/M4SifGcdUE-583.webp" type="image/webp"><source media="(max-width:1920px)" srcset="/img/optimized/M4SifGcdUE-583.jpeg"><img class="" src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-3.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-3.png" width=""></picture></p>
</li>
<li>
<p>joinæ—¶çš„æœ€åä¸€ä¸ªè¡¨ä¼šé€šè¿‡reduceræµå¼ä¼ è¾“ï¼Œå¹¶åœ¨å…¶ä¸­ç¼“å†²ä¹‹å‰çš„å…¶ä»–è¡¨ï¼Œå› æ­¤ï¼Œå°†å¤§è¡¨æ”¾ç½®åœ¨æœ€åæœ‰åŠ©äºå‡å°‘reduceré˜¶æ®µç¼“å­˜æ•°æ®æ‰€éœ€è¦çš„å†…å­˜<picture src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-5.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-5.png"><source media="(max-width:480px)" srcset="/img/optimized/y8EKrDuIhk-500.webp" type="image/webp">
<source media="(max-width:480px)" srcset="/img/optimized/y8EKrDuIhk-500.jpeg">
<source media="(max-width:1920px)" srcset="/img/optimized/y8EKrDuIhk-700.webp" type="image/webp"><source media="(max-width:1920px)" srcset="/img/optimized/y8EKrDuIhk-700.jpeg"><img class="" src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-5.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-5.png" width=""></picture></p>
</li>
<li>
<p>åœ¨joinçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è¯­æ³•STREAMTABLEæç¤ºæŒ‡å®šè¦æµå¼ä¼ è¾“çš„è¡¨ã€‚å¦‚æœçœç•¥STREAMTABLEæç¤ºï¼Œåˆ™Hiveå°†æµå¼ä¼ è¾“æœ€å³è¾¹çš„è¡¨ã€‚<picture src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-6.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-6.png"><source media="(max-width:480px)" srcset="/img/optimized/YLKn6MlEdD-500.webp" type="image/webp">
<source media="(max-width:480px)" srcset="/img/optimized/YLKn6MlEdD-500.jpeg">
<source media="(max-width:1920px)" srcset="/img/optimized/YLKn6MlEdD-700.webp" type="image/webp"><source media="(max-width:1920px)" srcset="/img/optimized/YLKn6MlEdD-700.jpeg"><img class="" src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-6.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-6.png" width=""></picture></p>
</li>
</ul>
<hr>
<h4 id="07-hive-sql" tabindex="-1">çŸ¥è¯†ç‚¹07ï¼šHive SQL--ç¬¬ä¸€ä»£å®¢æˆ·ç«¯çš„åŠŸèƒ½</h4>
<blockquote>
<p><mark>æ‰¹å¤„ç†</mark>ï¼šä¸€æ¬¡è¿æ¥ï¼Œä¸€æ¬¡äº¤äº’ï¼Œ æ‰§è¡Œç»“æŸæ–­å¼€è¿æ¥<br>
<mark>äº¤äº’å¼å¤„ç†</mark>ï¼šä¿æŒæŒç»­è¿æ¥ï¼Œ ä¸€ç›´äº¤äº’</p>
<p>æ³¨æ„ï¼šå¦‚æœè¯´hiveçš„shellå®¢æˆ·ç«¯ æŒ‡çš„æ˜¯ç¬¬ä¸€ä»£å®¢æˆ·ç«¯bin/hive</p>
<p>è€Œç¬¬äºŒä»£å®¢æˆ·ç«¯bin/beelineå±äºJDBCå®¢æˆ·ç«¯ ä¸æ˜¯shellã€‚</p>
</blockquote>
<p><mark><strong>bin/hive</strong></mark></p>
<ul>
<li>
<p>åŠŸèƒ½1ï¼šä½œä¸º<mark>ç¬¬ä¸€ä»£å®¢æˆ·ç«¯</mark> è¿æ¥è®¿é—®<mark>metastoreæœåŠ¡</mark>ï¼Œä½¿ç”¨Hiveã€‚äº¤äº’å¼æ–¹å¼</p>
</li>
<li>
<p>åŠŸèƒ½2ï¼šå¯åŠ¨hiveæœåŠ¡</p>
<pre><code class="language-shell">/export/server/apache-hive-3.1.2-bin/bin/hive --service metastore 
/export/server/apache-hive-3.1.2-bin/bin/hive --service hiveserver2 
</code></pre>
</li>
<li>
<p>åŠŸèƒ½3ï¼šæ‰¹å¤„ç†æ‰§è¡ŒHive SQL å‘½ä»¤ååŠ -eåè·Ÿå‘½ä»¤ï¼Œ-fåè·Ÿè„šæœ¬æ–‡ä»¶</p>
<pre><code class="language-shell"><a class="tag" onclick="toggleTagSearch(this)" data-content="#-e">#-e</a> æ‰§è¡Œåé¢çš„sqlè¯­å¥
/export/server/apache-hive-3.1.2-bin/bin/hive  -e 'select * from itheima.student'

<a class="tag" onclick="toggleTagSearch(this)" data-content="#-f">#-f</a> æ‰§è¡Œåé¢çš„sqlæ–‡ä»¶
vim hive.sql
select * from itheima.student limit 2

/export/server/apache-hive-3.1.2-bin/bin/hive  -f hive.sql

<a class="tag" onclick="toggleTagSearch(this)" data-content="#sqlæ–‡ä»¶ä¸ä¸€å®šæ˜¯">#sqlæ–‡ä»¶ä¸ä¸€å®šæ˜¯</a>.sql è¦ä¿è¯æ–‡ä»¶ä¸­æ˜¯æ­£ç¡®çš„HQLè¯­æ³•ã€‚

<a class="tag" onclick="toggleTagSearch(this)" data-content="#-fè°ƒç”¨sqlæ–‡ä»¶æ‰§è¡Œçš„æ–¹å¼">#-fè°ƒç”¨sqlæ–‡ä»¶æ‰§è¡Œçš„æ–¹å¼</a> æ˜¯ä¼ä¸šä¸­hiveç”Ÿäº§ç¯å¢ƒä¸»æµçš„è°ƒç”¨æ–¹å¼ã€‚
</code></pre>
</li>
</ul>
<hr>
<h4 id="08-hive-sql" tabindex="-1">çŸ¥è¯†ç‚¹08ï¼šHive SQL--å‚æ•°é…ç½®æ–¹å¼ä¸ä¼˜å…ˆçº§èŒƒå›´</h4>
<ul>
<li>
<p>æœ‰å“ªäº›å‚æ•°å¯ä»¥é…ç½®ï¼Ÿ</p>
<pre><code>https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties
</code></pre>
</li>
<li>
<p>é…ç½®æ–¹å¼æœ‰å“ªäº›ï¼Ÿ æ³¨æ„é…ç½®æ–¹å¼å½±å“èŒƒå›´å½±å“æ—¶é—´æ˜¯æ€æ ·ï¼Ÿ</p>
<ul>
<li>
<p>æ–¹å¼1ï¼šé…ç½®æ–‡ä»¶ con/<mark>hive-site.xml</mark></p>
<pre><code>å½±å“çš„æ˜¯åŸºäºè¿™ä¸ªå®‰è£…åŒ…çš„ä»»ä½•ä½¿ç”¨æ–¹å¼ã€‚
</code></pre>
</li>
<li>
<p>æ–¹å¼2ï¼šé…ç½®å‚æ•° <mark>--hiveconf</mark></p>
<pre><code class="language-shell">/export/server/apache-hive-3.1.2-bin/bin/hive --service metastore  

/export/server/apache-hive-3.1.2-bin/bin/hive --service hiveserver2  --hiveconf hive.root.logger=DEBUG,console

<a class="tag" onclick="toggleTagSearch(this)" data-content="#å½±å“çš„æ˜¯sessionä¼šè¯çº§åˆ«çš„">#å½±å“çš„æ˜¯sessionä¼šè¯çº§åˆ«çš„</a>
</code></pre>
</li>
<li>
<p>æ–¹å¼3ï¼š<mark>setå‘½ä»¤</mark></p>
<pre><code>sessionä¼šè¯çº§åˆ«çš„ è®¾ç½®å®Œä¹‹åå°†ä¼šå¯¹åé¢çš„sqlæ‰§è¡Œç”Ÿæ•ˆã€‚
sessionç»“æŸ setè®¾ç½®çš„å‚æ•°å°†å¤±æ•ˆã€‚

ä¹Ÿæ˜¯æ¨èæ­å»ºä½¿ç”¨çš„è®¾ç½®å‚æ•°æ–¹å¼ã€‚  è°éœ€è¦ è°è®¾ç½® è°ç”Ÿæ•ˆ
</code></pre>
</li>
</ul>
</li>
<li>
<p>æ€»ç»“</p>
<ul>
<li>ä»æ–¹å¼1åˆ°æ–¹å¼3 <mark>å½±å“çš„èŒƒå›´æ˜¯è¶Šæ¥è¶Šå°çš„</mark>ã€‚</li>
<li>ä»æ–¹å¼1åˆ°æ–¹å¼3 ä¼˜å…ˆçº§è¶Šæ¥è¶Šé«˜ã€‚setå‘½ä»¤è®¾ç½®çš„ä¼šè¦†ç›–å…¶ä»–çš„ã€‚</li>
<li>Hiveä½œä¸ºçš„åŸºäºHadoopçš„æ•°ä»“ï¼Œä¹Ÿä¼š<mark>æŠŠHadoop çš„ç›¸å…³é…ç½® è§£æåŠ è½½</mark>è¿›æ¥ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h4 id="09-hive-sql" tabindex="-1">çŸ¥è¯†ç‚¹09ï¼šHive SQL--å†…ç½®å¸¸è§è¿ç®—ç¬¦</h4>
<ul>
<li>
<p>å®˜æ–¹é“¾æ¥ï¼š<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF" target="_blank" class="external-link">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF</a></p>
</li>
<li>
<p>æŸ¥çœ‹è¿ç®—ç¬¦å’Œå‡½æ•°çš„å¸®åŠ©æ‰‹å†Œ</p>
</li>
<li>
<p>å¯ä»¥ä½¿ç”¨è¯¾ç¨‹èµ„æ–™ä¸­ä¸­æ–‡ç‰ˆå‚è€ƒæ‰‹å†Œ</p>
<pre><code class="language-sql">--æ˜¾ç¤ºæ‰€æœ‰çš„å‡½æ•°å’Œè¿ç®—ç¬¦
show functions;
--æŸ¥çœ‹è¿ç®—ç¬¦æˆ–è€…å‡½æ•°çš„ä½¿ç”¨è¯´æ˜
describe function +;
--ä½¿ç”¨extended å¯ä»¥æŸ¥çœ‹æ›´åŠ è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
describe function extended +;
</code></pre>
</li>
<li>
<p>å…·ä½“åˆ†ç±»</p>
<ul>
<li>å…³ç³»è¿ç®—ç¬¦</li>
<li>ç®—æœ¯è¿ç®—ç¬¦</li>
<li>é€»è¾‘è¿ç®—ç¬¦</li>
</ul>
</li>
</ul>
<pre><code class="language-sql">--1ã€åˆ›å»ºè¡¨dual
create table dual(id string);
--2ã€åŠ è½½ä¸€ä¸ªæ–‡ä»¶dual.txtåˆ°dualè¡¨ä¸­
--dual.txtåªæœ‰ä¸€è¡Œå†…å®¹ï¼šå†…å®¹ä¸ºä¸€ä¸ªç©ºæ ¼
load data local inpath '/root/hivedata/dual.txt' into table dual;
--3ã€åœ¨selectæŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨dualè¡¨å®Œæˆè¿ç®—ç¬¦ã€å‡½æ•°åŠŸèƒ½æµ‹è¯•
select 1+1 from dual;

select 1+1;

----------------Hiveä¸­å…³ç³»è¿ç®—ç¬¦--------------------------
--is nullç©ºå€¼åˆ¤æ–­
select 1 from dual where 'itcast' is null;

--is not null éç©ºå€¼åˆ¤æ–­
select 1 from dual where 'itcast' is not null;

--likeæ¯”è¾ƒï¼š _è¡¨ç¤ºä»»æ„å•ä¸ªå­—ç¬¦ %è¡¨ç¤ºä»»æ„æ•°é‡å­—ç¬¦
- åœ¨mysqlä¸­å«æ¨¡ç³ŠæŸ¥è¯¢
--å¦å®šæ¯”è¾ƒï¼š NOT A like B
select 1 from dual where 'itcast' like 'it_';
select 1 from dual where 'itcast' like 'it%';
select 1 from dual where  'itcast' not like 'hadoo_';
select 1 from dual where  not 'itcast' like 'hadoo_';

- rlikeï¼šç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ˜¯REGEXP_LIKE()çš„åŒä¹‰è¯ã€‚
select 1 from dual where 'itcast' rlike '^i.*t

-----

#### çŸ¥è¯†ç‚¹10ï¼šHive SQL--å‡½æ•°åŠåˆ†ç±»æ ‡å‡†ï¼ˆUDFã€UDAFã€UDTFï¼‰

å†…ç½®çš„å‡½æ•°ï¼ˆ==build in func==ï¼‰

&gt; æ‰€è°“çš„å†…ç½®æŒ‡çš„æ˜¯hiveå¼€å‘å¥½ï¼Œå¯ä»¥ç›´æ¥ä¸Šæ‰‹ä½¿ç”¨çš„ï¼›

- å†…ç½®å‡½æ•°å¾€å¾€æ ¹æ®å‡½æ•°çš„åº”ç”¨åŠŸèƒ½ç±»å‹æ¥åˆ†ç±»
- æ—¥æœŸå‡½æ•°ã€æ•°å­—å‡½æ•°ã€å­—ç¬¦ä¸²å‡½æ•°ã€é›†åˆå‡½æ•°ã€æ¡ä»¶å‡½æ•°....



ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆ==user-defined function==ï¼‰

&gt; ç”¨æˆ·ç¼–ç¨‹å®ç°å‡½æ•°çš„é€»è¾‘åœ¨hiveä¸­ä½¿ç”¨ã€‚

- UDFæ ¹æ®å‡½æ•°==è¾“å…¥è¡Œæ•°å’Œè¾“å‡ºè¡Œæ•°==è¿›è¡Œåˆ†ç±»

- UDF ã€UDAFã€UDTF![7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-7.png](/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-7.png)

  ```shell
  <a class="tag" onclick="toggleTagSearch(this)" data-content="#1ã€UDFï¼ˆUser-Defined-Functionï¼‰æ™®é€šå‡½æ•°">#1ã€UDFï¼ˆUser-Defined-Functionï¼‰æ™®é€šå‡½æ•°</a> ä¸€è¿›ä¸€å‡º  è¾“å…¥ä¸€è¡Œæ•°æ®è¾“å‡ºä¸€è¡Œæ•°æ®
  
  0: jdbc:hive2://node1:10000&gt; select split(&quot;allen woon hadoop&quot;,&quot; &quot;);
  +----------------------------+--+
  |            _c0             |
  +----------------------------+--+
  | [&quot;allen&quot;,&quot;woon&quot;,&quot;hadoop&quot;]  |
  +----------------------------+--+
  
  <a class="tag" onclick="toggleTagSearch(this)" data-content="#2ã€UDAFï¼ˆUser-Defined">#2ã€UDAFï¼ˆUser-Defined</a> Aggregation Functionï¼‰èšåˆå‡½æ•°ï¼Œå¤šè¿›ä¸€å‡º è¾“å…¥å¤šè¡Œè¾“å‡ºä¸€è¡Œ
  
  count sum max  min  avg
  
  <a class="tag" onclick="toggleTagSearch(this)" data-content="#3ã€UDTFï¼ˆUser-Defined">#3ã€UDTFï¼ˆUser-Defined</a> Table-Generating Functionsï¼‰è¡¨ç”Ÿæˆå‡½æ•° ä¸€è¿›å¤šå‡º è¾“å…¥ä¸€è¡Œè¾“å‡ºå¤šè¡Œ
  
  explode ã€parse_url_tuple
</code></pre>
<p><mark><strong>UDFåˆ†ç±»æ ‡å‡†çš„æ‰©å¤§åŒ–</strong></mark></p>
<ul>
<li>æœ¬æ¥ï¼Œudf/udtf/udaf3ä¸ªæ ‡å‡†æ˜¯é’ˆå¯¹ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°åˆ†ç±»çš„ï¼›</li>
<li>ä½†æ˜¯ï¼Œç°åœ¨å¯ä»¥å°†è¿™ä¸ªåˆ†ç±»æ ‡å‡†æ‰©å¤§åˆ°<mark>hiveä¸­æ‰€æœ‰çš„å‡½æ•°ï¼ŒåŒ…æ‹¬å†…ç½®å‡½æ•°å’Œè‡ªå®šä¹‰å‡½æ•°</mark>ï¼›</li>
<li>ä¸è¦è¢«UDè¿™ä¸¤ä¸ªå­—æ¯æ‰€å½±å“ã€‚ Built-in Aggregate Functions (UDAF).</li>
</ul>
<p>å‡½æ•°ç›¸å…³çš„å¸¸ç”¨å¸®åŠ©å‘½ä»¤</p>
<pre><code class="language-sql">--æ˜¾ç¤ºæ‰€æœ‰çš„å‡½æ•°å’Œè¿ç®—ç¬¦
show functions;
--æŸ¥çœ‹è¿ç®—ç¬¦æˆ–è€…å‡½æ•°çš„ä½¿ç”¨è¯´æ˜
describe function +;
desc function 
--ä½¿ç”¨extended å¯ä»¥æŸ¥çœ‹æ›´åŠ è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
describe function extended count;
</code></pre>
<hr>
<h4 id="11-hive-sql" tabindex="-1">çŸ¥è¯†ç‚¹11ï¼šHive SQL--å¸¸ç”¨å†…ç½®å‡½æ•°æ¢³ç†--å­—ç¬¦ä¸²å‡½æ•°</h4>
<pre><code class="language-sql">
desc function extended concat_ws;
-- æ³¨æ„ï¼šæŸ¥çœ‹ä¸€ä¸ªå‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ç©¶ç«çœ‹ä»€ä¹ˆï¼Ÿ
-- çœ‹æ–¹æ³•çš„ç­¾ååˆ—è¡¨concat_wsï¼ˆseparatorï¼Œ[string|arrayï¼ˆstring)]+)
ä»€ä¹ˆæ˜¯ç­¾ååˆ—è¡¨ï¼šï¼ˆå‡½æ•°æˆ–è€…æ–¹æ³•éœ€è¦å‡ ä¸ªå‚æ•°ï¼Œä»€ä¹ˆç±»å‹çš„å‚æ•°ï¼Œå‚æ•°çš„é¡ºåºï¼‰


-- StringFunctionså­—ç¬¦ä¸²å‡½æ•°--
select concat(&quot;angela&quot;,&quot;baby&quot;);
-- å¸¦åˆ†éš”ç¬¦å­—ç¬¦ä¸²è¿æ¥å‡½æ•°ï¼šconcat_wsï¼ˆseparatorï¼Œ[string|array(string)ã€‘+)
select concat_wsï¼ˆ'.','www',array('itcast', 'cn'));


--å­—ç¬¦ä¸²æˆªå–å‡½æ•°ï¼šsubstr(str, pos[, len]) æˆ–è€…  substring(str, pos[, len])
select substr(&quot;angelababy&quot;,-2); --posæ˜¯ä»1å¼€å§‹çš„ç´¢å¼•ï¼Œå¦‚æœä¸ºè´Ÿæ•°åˆ™å€’ç€æ•°
select substr(&quot;angelababy&quot;,2,2);


æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å‡½æ•°ï¼šregexp_replace(str, regexp, rep)
select regexp_replace('100-200', '(\\d+)', 'num'); --æ­£åˆ™åˆ†ç»„
                                  æ‰€æœ‰æ•°å­—æ›¿æ¢æˆ'num'ï¼š'num-num'

--æ­£åˆ™è¡¨è¾¾å¼è§£æå‡½æ•°ï¼šregexp_extract(str, regexp[, idx]) æå–æ­£åˆ™åŒ¹é…åˆ°çš„æŒ‡å®šç»„å†…å®¹
select regexp_extract('100-200', '(\\d+)-(\\d+)', 2);


URLè§£æå‡½æ•°ï¼šparse_url æ³¨æ„è¦æƒ³ä¸€æ¬¡è§£æå‡ºå¤šä¸ª å¯ä»¥ä½¿ç”¨parse_url_tupleè¿™ä¸ªUDTFå‡½æ•°
select parse_url('http://www.itcast.cn/path/p1.php?query=1', 'HOST'); 
select parse_url('http://www.itcast.cn/path/p1.php?query=1', 'PATH');


åˆ†å‰²å­—ç¬¦ä¸²å‡½æ•°: split(str, regex)ï¼š regexè¡¨ç¤ºæ”¯æŒæ­£åˆ™
select split('apache hive', '\\s+'); --åŒ¹é…ä¸€ä¸ªæˆ–è€…å¤šä¸ªç©ºç™½ç¬¦
                    **è®°ä½**ï¼š'\s'è¡¨ç¤ºï¼šåŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰

--jsonè§£æå‡½æ•°ï¼šget_json_object(json_txt, path)
--$è¡¨ç¤ºjsonå¯¹è±¡
select get_json_object('[{&quot;website&quot;:&quot;www.itcast.cn&quot;,&quot;name&quot;:&quot;allenwoon&quot;}, {&quot;website&quot;:&quot;cloud.itcast.com&quot;,&quot;name&quot;:&quot;carbondata ä¸­æ–‡æ–‡æ¡£&quot;}]', '$.[1].website');

</code></pre>
<hr>
<h4 id="12-hive-sql" tabindex="-1">çŸ¥è¯†ç‚¹12ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ—¶é—´æ—¥æœŸã€æ•°å€¼</h4>
<p>Date Functions æ—¥æœŸå‡½æ•°</p>
<blockquote>
<p>æ—¥æœŸå’Œæ—¶é—´æˆ³æ•°å­—ä¹‹é—´çš„è½¬æ¢</p>
<p><mark>unix_timestamp</mark> æ—¥æœŸè½¬unixæ—¶é—´æˆ³</p>
<p><mark>from_unixtime</mark> unixæ—¶é—´æˆ³è½¬æ—¥æœŸ</p>
<p><mark>date_add</mark></p>
<p><mark>date_sub</mark></p>
<p><mark>datediff</mark></p>
</blockquote>
<pre><code class="language-sql">--è·å–å½“å‰æ—¥æœŸ: current_date
select current_date();
--è·å–å½“å‰æ—¶é—´æˆ³: current_timestamp
--åŒä¸€æŸ¥è¯¢ä¸­å¯¹current_timestampçš„æ‰€æœ‰è°ƒç”¨å‡è¿”å›ç›¸åŒçš„å€¼ã€‚
select current_timestamp();
--è·å–å½“å‰UNIXæ—¶é—´æˆ³å‡½æ•°: unix_timestamp
select unix_timestamp();
--æ—¥æœŸè½¬UNIXæ—¶é—´æˆ³å‡½æ•°: unix_timestamp

select unix_timestamp(&quot;2011-12-07 13:01:03&quot;);
ğŸ‘†è¦æ±‚æ—¥æœŸæ ¼å¼å¿…é¡»æ˜¯æ ‡å‡†çš„æ—¥æœŸæ ¼å¼ï¼šdata å¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’

--æŒ‡å®šæ ¼å¼æ—¥æœŸè½¬UNIXæ—¶é—´æˆ³å‡½æ•°: unix_timestamp
select unix_timestamp('20111207 13:01:03','yyyyMMdd HH:mm:ss');
ğŸ‘†è‡ªå®šä¹‰æ—¶é—´æ ¼å¼éœ€è¦æ‰‹åŠ¨è®¾ç½®

- UNIXæ—¶é—´æˆ³è½¬æ—¥æœŸå‡½æ•°: from_unixtime
select from_unixtime(1620723323);
select from_unixtime(0, 'yyyy-MM-dd HH:mm:ss'); ï¼š'1970-01-01 00:00:00'


--æ—¥æœŸæ¯”è¾ƒå‡½æ•°: datediff  æ—¥æœŸæ ¼å¼è¦æ±‚'yyyy-MM-dd HH:mm:ss' or 'yyyy-MM-dd'
select datediff('2012-12-08','2012-05-09');
--æ—¥æœŸå¢åŠ å‡½æ•°: date_add
select date_add('2012-02-28',10);
--æ—¥æœŸå‡å°‘å‡½æ•°: date_sub
select date_sub('2012-01-1',10);
</code></pre>
<hr>
<p>Mathematical Functions æ•°å­¦å‡½æ•°</p>
<blockquote>
<p><mark>round</mark> å–æ•´</p>
<p><mark>rand</mark> å–éšæœºå€¼</p>
</blockquote>
<pre><code class="language-sql">--å–æ•´å‡½æ•°: round  è¿”å›doubleç±»å‹çš„æ•´æ•°å€¼éƒ¨åˆ† ï¼ˆéµå¾ªå››èˆäº”å…¥ï¼‰
select round(3.1415926);
--æŒ‡å®šç²¾åº¦å–æ•´å‡½æ•°: round(double a, int d) è¿”å›æŒ‡å®šç²¾åº¦dçš„doubleç±»å‹
select round(3.1415926,4);
--å‘ä¸‹å–æ•´å‡½æ•°: floor
select floor(3.1415926);
select floor(-3.1415926);ï¼š-4
--å‘ä¸Šå–æ•´å‡½æ•°: ceil
select ceil(3.1415926);
select ceil(-3.1415926);ï¼š-3
--å–éšæœºæ•°å‡½æ•°: rand æ¯æ¬¡æ‰§è¡Œéƒ½ä¸ä¸€æ · è¿”å›ä¸€ä¸ª0åˆ°1èŒƒå›´å†…çš„éšæœºæ•°
select rand();
--æŒ‡å®šç§å­å–éšæœºæ•°å‡½æ•°: rand(int seed) å¾—åˆ°ä¸€ä¸ªç¨³å®šçš„éšæœºæ•°åºåˆ—
select rand(5);
</code></pre>
<hr>
<h4 id="13-hive-sql" tabindex="-1">çŸ¥è¯†ç‚¹13ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ¡ä»¶è½¬æ¢ã€é›†åˆã€åŠ å¯†</h4>
<p>Conditional Functions æ¡ä»¶å‡½æ•°</p>
<blockquote>
<p><mark>éƒ½é‡è¦</mark>ã€‚å°¤å…¶æ˜¯case when</p>
</blockquote>
<pre><code class="language-sql">--ifæ¡ä»¶åˆ¤æ–­: if(boolean testCondition, T valueTrue, T valueFalseOrNull)
select if(1=2,100,200);
select if(sex ='ç”·','M','W') from student limit 3; 
ğŸ‘†å¦‚æœæ˜¯ç”·ï¼Œè¿”å›mï¼Œå¦åˆ™w

--ç©ºåˆ¤æ–­å‡½æ•°: isnull( a )
select isnull(&quot;allen&quot;);
select isnull(null);

--éç©ºåˆ¤æ–­å‡½æ•°: isnotnull ( a )
select isnotnull(&quot;allen&quot;);
select isnotnull(null);

-ç©ºå€¼è½¬æ¢å‡½æ•°: nvl(T value, T default_value)
æŠŠå¯èƒ½å­˜åœ¨çš„nullå€¼è½¬ä¸º0ï¼Œå› ä¸ºä»»ä½•å€¼+nullåˆ™ä¸€å®šè¿”å›null
â­å°†NULLå€¼æ›¿æ¢ä¸ºæŒ‡å®šçš„é»˜è®¤å€¼ï¼Œè‹¥ç¬¬ä¸€ä¸ªå‚æ•°éNULLåˆ™è¿”å›è‡ªèº«ï¼Œå¦åˆ™è¿”å›ç¬¬äºŒä¸ªå‚æ•°ã€‚â­
select nvl(&quot;allen&quot;,&quot;itcast&quot;);
select nvl(null,&quot;itcast&quot;);

--éç©ºæŸ¥æ‰¾å‡½æ•°: COALESCE(T v1, T v2, ...)
-è¿”å›å‚æ•°ä¸­çš„ç¬¬ä¸€ä¸ªéç©ºå€¼ï¼›å¦‚æœæ‰€æœ‰å€¼éƒ½ä¸ºNULLï¼Œé‚£ä¹ˆè¿”å›NULL
select COALESCE(null,11,22,33);
select COALESCE(null,null,null,33);
select COALESCE(null,null,null);

- æ¡ä»¶è½¬æ¢å‡½æ•°: CASE a WHEN b THEN c [WHEN d THEN e]* [ELSE f] END
ç®€å•CASEè¡¨è¾¾å¼ï¼Œå°†è¡¨è¾¾å¼ä¸æ¯ä¸ªWHENåçš„æ¡ä»¶åŒ¹é…ï¼Œè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç»“æœï¼Œå¦åˆ™è¿”å›ELSEå€¼ï¼ˆæ— ELSEæ—¶é»˜è®¤è¿”å›NULLï¼‰ã€‚ç»“æœï¼šmary
select case 100 when 50 then 'tom' when 100 then 'mary' else 'tim' end;
å¯¹100åˆ¤æ–­ï¼Œå¦‚æœæ˜¯50åˆ™è¿”å›tomï¼Œå¦‚æœæ˜¯100åˆ™è¿”å›maryï¼Œå¦åˆ™è¿”å›timï¼Œè¿™é‡Œæ˜¾ç„¶è¿”å›mary
select case sex when 'ç”·' then 'male' else 'female' end from student limit 3;
</code></pre>
<hr>
<p>Type Conversion Functions ç±»å‹è½¬æ¢å‡½æ•°</p>
<ul>
<li>
<p>å‰ç½®çŸ¥è¯†ï¼šHiveä¸­æ”¯æŒç±»å‹çš„éšå¼è½¬æ¢ æœ‰é™åˆ¶ è‡ªåŠ¨è½¬æ¢ ä¸ä¿è¯æˆåŠŸ å°±æ˜¾ç¤ºnull</p>
</li>
<li>
<p><mark>castæ˜¾ç¤ºç±»å‹è½¬æ¢å‡½æ•°</mark></p>
<pre><code class="language-sql">--ä»»æ„æ•°æ®ç±»å‹ä¹‹é—´è½¬æ¢:cast
- castå±äºç”¨æˆ·çš„æ˜¾ç¤ºç±»å‹è½¬æ¢ï¼Œhiveåº•å±‚è¿˜ä¼šè¿›è¡Œéšå¼ç±»å‹è½¬æ¢ï¼Œå¯èƒ½å¤±è´¥
select cast(12.14 as bigint);
select cast(12.14 as string);
select cast(&quot;hello&quot; as int);
+-------+
|  _c0  |
+-------+
| NULL  |
+-------+
</code></pre>
</li>
</ul>
<hr>
<p>Data Masking Functions æ•°æ®è„±æ•å‡½æ•°</p>
<blockquote>
<p>maskè„±æ• æ©ç å¤„ç†</p>
<p>æ•°æ®è„±æ•ï¼š<mark>è®©æ•æ„Ÿæ•°æ®ä¸æ•æ„Ÿ</mark> 13455667788 ---&gt;134****7788</p>
</blockquote>
<pre><code class="language-sql">--mask
--å°†æŸ¥è¯¢å›çš„æ•°æ®ï¼Œå¤§å†™å­—æ¯è½¬æ¢ä¸ºXï¼Œå°å†™å­—æ¯è½¬æ¢ä¸ºxï¼Œæ•°å­—è½¬æ¢ä¸ºnã€‚
select mask(&quot;abc123DEF&quot;); è¾“å‡ºï¼šxxxnnnXXX
select mask(&quot;abc123DEF&quot;,'-','.','^'); è‡ªå®šä¹‰æ›¿æ¢çš„å­—æ¯ è¾“å‡ºï¼š...^^^---
ğŸ‘†'-','.','^'è¡¨ç¤ºå¤§å†™å­—æ¯è½¬æ¢ä¸º-ï¼Œå°å†™å­—æ¯è½¬æ¢ä¸º.ï¼Œæ•°å­—è½¬æ¢ä¸º^^^


--mask_first_n(string str[, int n]
--å¯¹å‰nä¸ªè¿›è¡Œè„±æ•æ›¿æ¢
select mask_first_n(&quot;abc123DEF&quot;,4);

--mask_last_n(string str[, int n])
select mask_last_n(&quot;abc123DEF&quot;,4);

--mask_show_first_n(string str[, int n])
--é™¤äº†å‰nä¸ªå­—ç¬¦ï¼Œå…¶ä½™è¿›è¡Œæ©ç å¤„ç†
select mask_show_first_n(&quot;abc123DEF&quot;,4);

--mask_show_last_n(string str[, int n])
select mask_show_last_n(&quot;abc123DEF&quot;,4);

--mask_hash(string|char|varchar str)
--è¿”å›å­—ç¬¦ä¸²çš„hashç¼–ç ã€‚
select mask_hash(&quot;abc123DEF&quot;);

</code></pre>
<hr>
<p>Misc. Functions å…¶ä»–æ‚é¡¹å‡½æ•°ã€åŠ å¯†å‡½æ•°</p>
<pre><code class="language-sql">--å¦‚æœä½ è¦è°ƒç”¨çš„javaæ–¹æ³•æ‰€åœ¨çš„jaråŒ…ä¸æ˜¯hiveè‡ªå¸¦çš„ å¯ä»¥ä½¿ç”¨add jaræ·»åŠ è¿›æ¥
--hiveè°ƒç”¨javaæ–¹æ³•: java_method(class, method[, arg1[, arg2..]])
select java_method(&quot;java.lang.Math&quot;,&quot;max&quot;,11,22);

--åå°„å‡½æ•°: reflect(class, method[, arg1[, arg2..]])
select reflect(&quot;java.lang.Math&quot;,&quot;max&quot;,11,22);

--å–å“ˆå¸Œå€¼å‡½æ•°:hash
select hash(&quot;allen&quot;);

--current_user()ã€logged_in_user()ã€current_database()ã€version()

--SHA-1åŠ å¯†: sha1(string/binary)
select sha1(&quot;allen&quot;);

--SHA-2å®¶æ—ç®—æ³•åŠ å¯†ï¼šsha2(string/binary, int)  (SHA-224, SHA-256, SHA-384, SHA-512)
select sha2(&quot;allen&quot;,224);
select sha2(&quot;allen&quot;,512);

--crc32åŠ å¯†:
select crc32(&quot;allen&quot;);

--MD5åŠ å¯†: md5(string/binary)
select md5(&quot;allen&quot;);
</code></pre>
<p>;<br>
select 1 from dual where '123456' rlike '^\d+</p>
<hr>
<h4 id="10-hive-sql-udf-udaf-udtf" tabindex="-1">çŸ¥è¯†ç‚¹10ï¼šHive SQL--å‡½æ•°åŠåˆ†ç±»æ ‡å‡†ï¼ˆUDFã€UDAFã€UDTFï¼‰</h4>
<p>å†…ç½®çš„å‡½æ•°ï¼ˆ<mark>build in func</mark>ï¼‰</p>
<blockquote>
<p>æ‰€è°“çš„å†…ç½®æŒ‡çš„æ˜¯hiveå¼€å‘å¥½ï¼Œå¯ä»¥ç›´æ¥ä¸Šæ‰‹ä½¿ç”¨çš„ï¼›</p>
</blockquote>
<ul>
<li>å†…ç½®å‡½æ•°å¾€å¾€æ ¹æ®å‡½æ•°çš„åº”ç”¨åŠŸèƒ½ç±»å‹æ¥åˆ†ç±»</li>
<li>æ—¥æœŸå‡½æ•°ã€æ•°å­—å‡½æ•°ã€å­—ç¬¦ä¸²å‡½æ•°ã€é›†åˆå‡½æ•°ã€æ¡ä»¶å‡½æ•°....</li>
</ul>
<p>ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆ<mark>user-defined function</mark>ï¼‰</p>
<blockquote>
<p>ç”¨æˆ·ç¼–ç¨‹å®ç°å‡½æ•°çš„é€»è¾‘åœ¨hiveä¸­ä½¿ç”¨ã€‚</p>
</blockquote>
<ul>
<li>
<p>UDFæ ¹æ®å‡½æ•°<mark>è¾“å…¥è¡Œæ•°å’Œè¾“å‡ºè¡Œæ•°</mark>è¿›è¡Œåˆ†ç±»</p>
</li>
<li>
<p>UDF ã€UDAFã€UDTF<picture src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-7.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-7.png"><source media="(max-width:480px)" srcset="/img/optimized/jVk7r1jjNI-500.webp" type="image/webp">
<source media="(max-width:480px)" srcset="/img/optimized/jVk7r1jjNI-500.jpeg">
<source media="(max-width:1920px)" srcset="/img/optimized/jVk7r1jjNI-700.webp" type="image/webp"><source media="(max-width:1920px)" srcset="/img/optimized/jVk7r1jjNI-700.jpeg"><img class="" src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-7.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-7.png" width=""></picture></p>
<p>{{CODE_BLOCK_22}}</p>
</li>
</ul>
<p><mark><strong>UDFåˆ†ç±»æ ‡å‡†çš„æ‰©å¤§åŒ–</strong></mark></p>
<ul>
<li>æœ¬æ¥ï¼Œudf/udtf/udaf3ä¸ªæ ‡å‡†æ˜¯é’ˆå¯¹ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°åˆ†ç±»çš„ï¼›</li>
<li>ä½†æ˜¯ï¼Œç°åœ¨å¯ä»¥å°†è¿™ä¸ªåˆ†ç±»æ ‡å‡†æ‰©å¤§åˆ°<mark>hiveä¸­æ‰€æœ‰çš„å‡½æ•°ï¼ŒåŒ…æ‹¬å†…ç½®å‡½æ•°å’Œè‡ªå®šä¹‰å‡½æ•°</mark>ï¼›</li>
<li>ä¸è¦è¢«UDè¿™ä¸¤ä¸ªå­—æ¯æ‰€å½±å“ã€‚ Built-in Aggregate Functions (UDAF).</li>
</ul>
<p>å‡½æ•°ç›¸å…³çš„å¸¸ç”¨å¸®åŠ©å‘½ä»¤</p>
<p>{{CODE_BLOCK_23}}</p>
<hr>
<h4 id="11-hive-sql-1" tabindex="-1">çŸ¥è¯†ç‚¹11ï¼šHive SQL--å¸¸ç”¨å†…ç½®å‡½æ•°æ¢³ç†--å­—ç¬¦ä¸²å‡½æ•°</h4>
<p>{{CODE_BLOCK_24}}</p>
<hr>
<h4 id="12-hive-sql-1" tabindex="-1">çŸ¥è¯†ç‚¹12ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ—¶é—´æ—¥æœŸã€æ•°å€¼</h4>
<p>Date Functions æ—¥æœŸå‡½æ•°</p>
<blockquote>
<p>æ—¥æœŸå’Œæ—¶é—´æˆ³æ•°å­—ä¹‹é—´çš„è½¬æ¢</p>
<p><mark>unix_timestamp</mark> æ—¥æœŸè½¬unixæ—¶é—´æˆ³</p>
<p><mark>from_unixtime</mark> unixæ—¶é—´æˆ³è½¬æ—¥æœŸ</p>
<p><mark>date_add</mark></p>
<p><mark>date_sub</mark></p>
<p><mark>datediff</mark></p>
</blockquote>
<p>{{CODE_BLOCK_25}}</p>
<hr>
<p>Mathematical Functions æ•°å­¦å‡½æ•°</p>
<blockquote>
<p><mark>round</mark> å–æ•´</p>
<p><mark>rand</mark> å–éšæœºå€¼</p>
</blockquote>
<p>{{CODE_BLOCK_26}}</p>
<hr>
<h4 id="13-hive-sql-1" tabindex="-1">çŸ¥è¯†ç‚¹13ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ¡ä»¶è½¬æ¢ã€é›†åˆã€åŠ å¯†</h4>
<p>Conditional Functions æ¡ä»¶å‡½æ•°</p>
<blockquote>
<p><mark>éƒ½é‡è¦</mark>ã€‚å°¤å…¶æ˜¯case when</p>
</blockquote>
<p>{{CODE_BLOCK_27}}</p>
<hr>
<p>Type Conversion Functions ç±»å‹è½¬æ¢å‡½æ•°</p>
<ul>
<li>
<p>å‰ç½®çŸ¥è¯†ï¼šHiveä¸­æ”¯æŒç±»å‹çš„éšå¼è½¬æ¢ æœ‰é™åˆ¶ è‡ªåŠ¨è½¬æ¢ ä¸ä¿è¯æˆåŠŸ å°±æ˜¾ç¤ºnull</p>
</li>
<li>
<p><mark>castæ˜¾ç¤ºç±»å‹è½¬æ¢å‡½æ•°</mark></p>
<p>{{CODE_BLOCK_28}}</p>
</li>
</ul>
<hr>
<p>Data Masking Functions æ•°æ®è„±æ•å‡½æ•°</p>
<blockquote>
<p>maskè„±æ• æ©ç å¤„ç†</p>
<p>æ•°æ®è„±æ•ï¼š<mark>è®©æ•æ„Ÿæ•°æ®ä¸æ•æ„Ÿ</mark> 13455667788 ---&gt;134****7788</p>
</blockquote>
<p>{{CODE_BLOCK_29}}</p>
<hr>
<p>Misc. Functions å…¶ä»–æ‚é¡¹å‡½æ•°ã€åŠ å¯†å‡½æ•°</p>
<p>{{CODE_BLOCK_30}}</p>
<p>; --åˆ¤æ–­æ˜¯å¦å…¨ä¸ºæ•°å­—<br>
select 1 from dual where '123456aa' rlike '^\d+</p>
<hr>
<h4 id="10-hive-sql-udf-udaf-udtf-1" tabindex="-1">çŸ¥è¯†ç‚¹10ï¼šHive SQL--å‡½æ•°åŠåˆ†ç±»æ ‡å‡†ï¼ˆUDFã€UDAFã€UDTFï¼‰</h4>
<p>å†…ç½®çš„å‡½æ•°ï¼ˆ<mark>build in func</mark>ï¼‰</p>
<blockquote>
<p>æ‰€è°“çš„å†…ç½®æŒ‡çš„æ˜¯hiveå¼€å‘å¥½ï¼Œå¯ä»¥ç›´æ¥ä¸Šæ‰‹ä½¿ç”¨çš„ï¼›</p>
</blockquote>
<ul>
<li>å†…ç½®å‡½æ•°å¾€å¾€æ ¹æ®å‡½æ•°çš„åº”ç”¨åŠŸèƒ½ç±»å‹æ¥åˆ†ç±»</li>
<li>æ—¥æœŸå‡½æ•°ã€æ•°å­—å‡½æ•°ã€å­—ç¬¦ä¸²å‡½æ•°ã€é›†åˆå‡½æ•°ã€æ¡ä»¶å‡½æ•°....</li>
</ul>
<p>ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆ<mark>user-defined function</mark>ï¼‰</p>
<blockquote>
<p>ç”¨æˆ·ç¼–ç¨‹å®ç°å‡½æ•°çš„é€»è¾‘åœ¨hiveä¸­ä½¿ç”¨ã€‚</p>
</blockquote>
<ul>
<li>
<p>UDFæ ¹æ®å‡½æ•°<mark>è¾“å…¥è¡Œæ•°å’Œè¾“å‡ºè¡Œæ•°</mark>è¿›è¡Œåˆ†ç±»</p>
</li>
<li>
<p>UDF ã€UDAFã€UDTF<picture src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-7.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-7.png"><source media="(max-width:480px)" srcset="/img/optimized/jVk7r1jjNI-500.webp" type="image/webp">
<source media="(max-width:480px)" srcset="/img/optimized/jVk7r1jjNI-500.jpeg">
<source media="(max-width:1920px)" srcset="/img/optimized/jVk7r1jjNI-700.webp" type="image/webp"><source media="(max-width:1920px)" srcset="/img/optimized/jVk7r1jjNI-700.jpeg"><img class="" src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-7.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-7.png" width=""></picture></p>
<p>{{CODE_BLOCK_22}}</p>
</li>
</ul>
<p><mark><strong>UDFåˆ†ç±»æ ‡å‡†çš„æ‰©å¤§åŒ–</strong></mark></p>
<ul>
<li>æœ¬æ¥ï¼Œudf/udtf/udaf3ä¸ªæ ‡å‡†æ˜¯é’ˆå¯¹ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°åˆ†ç±»çš„ï¼›</li>
<li>ä½†æ˜¯ï¼Œç°åœ¨å¯ä»¥å°†è¿™ä¸ªåˆ†ç±»æ ‡å‡†æ‰©å¤§åˆ°<mark>hiveä¸­æ‰€æœ‰çš„å‡½æ•°ï¼ŒåŒ…æ‹¬å†…ç½®å‡½æ•°å’Œè‡ªå®šä¹‰å‡½æ•°</mark>ï¼›</li>
<li>ä¸è¦è¢«UDè¿™ä¸¤ä¸ªå­—æ¯æ‰€å½±å“ã€‚ Built-in Aggregate Functions (UDAF).</li>
</ul>
<p>å‡½æ•°ç›¸å…³çš„å¸¸ç”¨å¸®åŠ©å‘½ä»¤</p>
<p>{{CODE_BLOCK_23}}</p>
<hr>
<h4 id="11-hive-sql-2" tabindex="-1">çŸ¥è¯†ç‚¹11ï¼šHive SQL--å¸¸ç”¨å†…ç½®å‡½æ•°æ¢³ç†--å­—ç¬¦ä¸²å‡½æ•°</h4>
<p>{{CODE_BLOCK_24}}</p>
<hr>
<h4 id="12-hive-sql-2" tabindex="-1">çŸ¥è¯†ç‚¹12ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ—¶é—´æ—¥æœŸã€æ•°å€¼</h4>
<p>Date Functions æ—¥æœŸå‡½æ•°</p>
<blockquote>
<p>æ—¥æœŸå’Œæ—¶é—´æˆ³æ•°å­—ä¹‹é—´çš„è½¬æ¢</p>
<p><mark>unix_timestamp</mark> æ—¥æœŸè½¬unixæ—¶é—´æˆ³</p>
<p><mark>from_unixtime</mark> unixæ—¶é—´æˆ³è½¬æ—¥æœŸ</p>
<p><mark>date_add</mark></p>
<p><mark>date_sub</mark></p>
<p><mark>datediff</mark></p>
</blockquote>
<p>{{CODE_BLOCK_25}}</p>
<hr>
<p>Mathematical Functions æ•°å­¦å‡½æ•°</p>
<blockquote>
<p><mark>round</mark> å–æ•´</p>
<p><mark>rand</mark> å–éšæœºå€¼</p>
</blockquote>
<p>{{CODE_BLOCK_26}}</p>
<hr>
<h4 id="13-hive-sql-2" tabindex="-1">çŸ¥è¯†ç‚¹13ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ¡ä»¶è½¬æ¢ã€é›†åˆã€åŠ å¯†</h4>
<p>Conditional Functions æ¡ä»¶å‡½æ•°</p>
<blockquote>
<p><mark>éƒ½é‡è¦</mark>ã€‚å°¤å…¶æ˜¯case when</p>
</blockquote>
<p>{{CODE_BLOCK_27}}</p>
<hr>
<p>Type Conversion Functions ç±»å‹è½¬æ¢å‡½æ•°</p>
<ul>
<li>
<p>å‰ç½®çŸ¥è¯†ï¼šHiveä¸­æ”¯æŒç±»å‹çš„éšå¼è½¬æ¢ æœ‰é™åˆ¶ è‡ªåŠ¨è½¬æ¢ ä¸ä¿è¯æˆåŠŸ å°±æ˜¾ç¤ºnull</p>
</li>
<li>
<p><mark>castæ˜¾ç¤ºç±»å‹è½¬æ¢å‡½æ•°</mark></p>
<p>{{CODE_BLOCK_28}}</p>
</li>
</ul>
<hr>
<p>Data Masking Functions æ•°æ®è„±æ•å‡½æ•°</p>
<blockquote>
<p>maskè„±æ• æ©ç å¤„ç†</p>
<p>æ•°æ®è„±æ•ï¼š<mark>è®©æ•æ„Ÿæ•°æ®ä¸æ•æ„Ÿ</mark> 13455667788 ---&gt;134****7788</p>
</blockquote>
<p>{{CODE_BLOCK_29}}</p>
<hr>
<p>Misc. Functions å…¶ä»–æ‚é¡¹å‡½æ•°ã€åŠ å¯†å‡½æ•°</p>
<p>{{CODE_BLOCK_30}}</p>
<p>;</p>
<p>--regexpï¼šåŠŸèƒ½ä¸rlikeç›¸åŒ ç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼<br>
select 1 from dual where 'itcast' regexp '^i.*t</p>
<hr>
<h4 id="10-hive-sql-udf-udaf-udtf-2" tabindex="-1">çŸ¥è¯†ç‚¹10ï¼šHive SQL--å‡½æ•°åŠåˆ†ç±»æ ‡å‡†ï¼ˆUDFã€UDAFã€UDTFï¼‰</h4>
<p>å†…ç½®çš„å‡½æ•°ï¼ˆ<mark>build in func</mark>ï¼‰</p>
<blockquote>
<p>æ‰€è°“çš„å†…ç½®æŒ‡çš„æ˜¯hiveå¼€å‘å¥½ï¼Œå¯ä»¥ç›´æ¥ä¸Šæ‰‹ä½¿ç”¨çš„ï¼›</p>
</blockquote>
<ul>
<li>å†…ç½®å‡½æ•°å¾€å¾€æ ¹æ®å‡½æ•°çš„åº”ç”¨åŠŸèƒ½ç±»å‹æ¥åˆ†ç±»</li>
<li>æ—¥æœŸå‡½æ•°ã€æ•°å­—å‡½æ•°ã€å­—ç¬¦ä¸²å‡½æ•°ã€é›†åˆå‡½æ•°ã€æ¡ä»¶å‡½æ•°....</li>
</ul>
<p>ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆ<mark>user-defined function</mark>ï¼‰</p>
<blockquote>
<p>ç”¨æˆ·ç¼–ç¨‹å®ç°å‡½æ•°çš„é€»è¾‘åœ¨hiveä¸­ä½¿ç”¨ã€‚</p>
</blockquote>
<ul>
<li>
<p>UDFæ ¹æ®å‡½æ•°<mark>è¾“å…¥è¡Œæ•°å’Œè¾“å‡ºè¡Œæ•°</mark>è¿›è¡Œåˆ†ç±»</p>
</li>
<li>
<p>UDF ã€UDAFã€UDTF<picture src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-7.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-7.png"><source media="(max-width:480px)" srcset="/img/optimized/jVk7r1jjNI-500.webp" type="image/webp">
<source media="(max-width:480px)" srcset="/img/optimized/jVk7r1jjNI-500.jpeg">
<source media="(max-width:1920px)" srcset="/img/optimized/jVk7r1jjNI-700.webp" type="image/webp"><source media="(max-width:1920px)" srcset="/img/optimized/jVk7r1jjNI-700.jpeg"><img class="" src="/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-7.png" alt="7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-7.png" width=""></picture></p>
<p>{{CODE_BLOCK_22}}</p>
</li>
</ul>
<p><mark><strong>UDFåˆ†ç±»æ ‡å‡†çš„æ‰©å¤§åŒ–</strong></mark></p>
<ul>
<li>æœ¬æ¥ï¼Œudf/udtf/udaf3ä¸ªæ ‡å‡†æ˜¯é’ˆå¯¹ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°åˆ†ç±»çš„ï¼›</li>
<li>ä½†æ˜¯ï¼Œç°åœ¨å¯ä»¥å°†è¿™ä¸ªåˆ†ç±»æ ‡å‡†æ‰©å¤§åˆ°<mark>hiveä¸­æ‰€æœ‰çš„å‡½æ•°ï¼ŒåŒ…æ‹¬å†…ç½®å‡½æ•°å’Œè‡ªå®šä¹‰å‡½æ•°</mark>ï¼›</li>
<li>ä¸è¦è¢«UDè¿™ä¸¤ä¸ªå­—æ¯æ‰€å½±å“ã€‚ Built-in Aggregate Functions (UDAF).</li>
</ul>
<p>å‡½æ•°ç›¸å…³çš„å¸¸ç”¨å¸®åŠ©å‘½ä»¤</p>
<p>{{CODE_BLOCK_23}}</p>
<hr>
<h4 id="11-hive-sql-3" tabindex="-1">çŸ¥è¯†ç‚¹11ï¼šHive SQL--å¸¸ç”¨å†…ç½®å‡½æ•°æ¢³ç†--å­—ç¬¦ä¸²å‡½æ•°</h4>
<p>{{CODE_BLOCK_24}}</p>
<hr>
<h4 id="12-hive-sql-3" tabindex="-1">çŸ¥è¯†ç‚¹12ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ—¶é—´æ—¥æœŸã€æ•°å€¼</h4>
<p>Date Functions æ—¥æœŸå‡½æ•°</p>
<blockquote>
<p>æ—¥æœŸå’Œæ—¶é—´æˆ³æ•°å­—ä¹‹é—´çš„è½¬æ¢</p>
<p><mark>unix_timestamp</mark> æ—¥æœŸè½¬unixæ—¶é—´æˆ³</p>
<p><mark>from_unixtime</mark> unixæ—¶é—´æˆ³è½¬æ—¥æœŸ</p>
<p><mark>date_add</mark></p>
<p><mark>date_sub</mark></p>
<p><mark>datediff</mark></p>
</blockquote>
<p>{{CODE_BLOCK_25}}</p>
<hr>
<p>Mathematical Functions æ•°å­¦å‡½æ•°</p>
<blockquote>
<p><mark>round</mark> å–æ•´</p>
<p><mark>rand</mark> å–éšæœºå€¼</p>
</blockquote>
<p>{{CODE_BLOCK_26}}</p>
<hr>
<h4 id="13-hive-sql-3" tabindex="-1">çŸ¥è¯†ç‚¹13ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ¡ä»¶è½¬æ¢ã€é›†åˆã€åŠ å¯†</h4>
<p>Conditional Functions æ¡ä»¶å‡½æ•°</p>
<blockquote>
<p><mark>éƒ½é‡è¦</mark>ã€‚å°¤å…¶æ˜¯case when</p>
</blockquote>
<p>{{CODE_BLOCK_27}}</p>
<hr>
<p>Type Conversion Functions ç±»å‹è½¬æ¢å‡½æ•°</p>
<ul>
<li>
<p>å‰ç½®çŸ¥è¯†ï¼šHiveä¸­æ”¯æŒç±»å‹çš„éšå¼è½¬æ¢ æœ‰é™åˆ¶ è‡ªåŠ¨è½¬æ¢ ä¸ä¿è¯æˆåŠŸ å°±æ˜¾ç¤ºnull</p>
</li>
<li>
<p><mark>castæ˜¾ç¤ºç±»å‹è½¬æ¢å‡½æ•°</mark></p>
<p>{{CODE_BLOCK_28}}</p>
</li>
</ul>
<hr>
<p>Data Masking Functions æ•°æ®è„±æ•å‡½æ•°</p>
<blockquote>
<p>maskè„±æ• æ©ç å¤„ç†</p>
<p>æ•°æ®è„±æ•ï¼š<mark>è®©æ•æ„Ÿæ•°æ®ä¸æ•æ„Ÿ</mark> 13455667788 ---&gt;134****7788</p>
</blockquote>
<p>{{CODE_BLOCK_29}}</p>
<hr>
<p>Misc. Functions å…¶ä»–æ‚é¡¹å‡½æ•°ã€åŠ å¯†å‡½æ•°</p>
<p>{{CODE_BLOCK_30}}</p>
<p>;</p>
<p>-------------------Hiveä¸­ç®—æœ¯è¿ç®—ç¬¦---------------------------------<br>
--å–æ•´æ“ä½œ: div ç»™å‡ºå°†Aé™¤ä»¥Bæ‰€å¾—çš„æ•´æ•°éƒ¨åˆ†ã€‚ä¾‹å¦‚17 div 3å¾—å‡º5ã€‚<br>
select 17 div 3;</p>
<p>--å–ä½™æ“ä½œ: % ä¹Ÿå«åšå–æ¨¡mod Aé™¤ä»¥Bæ‰€å¾—çš„ä½™æ•°éƒ¨åˆ†<br>
select 17 % 3;</p>
<ul>
<li>
<p>ä½ä¸æ“ä½œ: &amp; Aå’ŒBæŒ‰ä½è¿›è¡Œä¸æ“ä½œçš„ç»“æœã€‚ ä¸è¡¨ç¤ºä¸¤ä¸ªéƒ½ä¸º1åˆ™ç»“æœä¸º1<br>
select 4 &amp; 8 from dual; --4è½¬æ¢äºŒè¿›åˆ¶ï¼š0100 8è½¬æ¢äºŒè¿›åˆ¶ï¼š1000<br>
select 6 &amp; 4 from dual; --4è½¬æ¢äºŒè¿›åˆ¶ï¼š0100 6è½¬æ¢äºŒè¿›åˆ¶ï¼š0110</p>
</li>
<li>
<p>ä½æˆ–æ“ä½œ: | Aå’ŒBæŒ‰ä½è¿›è¡Œæˆ–æ“ä½œçš„ç»“æœ æˆ–è¡¨ç¤ºæœ‰ä¸€ä¸ªä¸º1åˆ™ç»“æœä¸º1<br>
select 4 | 8 from dual;<br>
select 6 | 4 from dual;</p>
</li>
<li>
<p>ä½å¼‚æˆ–æ“ä½œ: ^ Aå’ŒBæŒ‰ä½è¿›è¡Œå¼‚æˆ–æ“ä½œçš„ç»“æœ å¼‚æˆ–è¡¨ç¤ºä¸¤è€…çš„å€¼ä¸åŒ,åˆ™ç»“æœä¸º1<br>
select 4 ^ 8 from dual;<br>
select 6 ^ 4 from dual;</p>
</li>
</ul>
<p>--3ã€Hiveé€»è¾‘è¿ç®—ç¬¦<br>
--ä¸æ“ä½œ: A AND B å¦‚æœAå’ŒBå‡ä¸ºTRUEï¼Œåˆ™ä¸ºTRUEï¼Œå¦åˆ™ä¸ºFALSEã€‚å¦‚æœAæˆ–Bä¸ºNULLï¼Œåˆ™ä¸ºNULLã€‚<br>
select 1 from dual where 3&gt;1 and 2&gt;1;<br>
--æˆ–æ“ä½œ: A OR B å¦‚æœAæˆ–Bæˆ–ä¸¤è€…å‡ä¸ºTRUEï¼Œåˆ™ä¸ºTRUEï¼Œå¦åˆ™ä¸ºFALSEã€‚<br>
select 1 from dual where 3&gt;1 or 2!=2;<br>
--éæ“ä½œ: NOT A ã€!A å¦‚æœAä¸ºFALSEï¼Œåˆ™ä¸ºTRUEï¼›å¦‚æœAä¸ºNULLï¼Œåˆ™ä¸ºNULLã€‚å¦åˆ™ä¸ºFALSEã€‚<br>
select 1 from dual where not 2&gt;1;<br>
select 1 from dual where !2=1;</p>
<p>--åœ¨:A IN (val1, val2, ...) å¦‚æœAç­‰äºä»»ä½•å€¼ï¼Œåˆ™ä¸ºTRUEã€‚<br>
select 1 from dual where 11 in(11,22,33);<br>
--ä¸åœ¨:A NOT IN (val1, val2, ...) å¦‚æœAä¸ç­‰äºä»»ä½•å€¼ï¼Œåˆ™ä¸ºTRUE<br>
select 1 from dual where 11 not in(22,33,44);</p>
<pre><code>
-----

#### çŸ¥è¯†ç‚¹10ï¼šHive SQL--å‡½æ•°åŠåˆ†ç±»æ ‡å‡†ï¼ˆUDFã€UDAFã€UDTFï¼‰

å†…ç½®çš„å‡½æ•°ï¼ˆ==build in func==ï¼‰

&gt; æ‰€è°“çš„å†…ç½®æŒ‡çš„æ˜¯hiveå¼€å‘å¥½ï¼Œå¯ä»¥ç›´æ¥ä¸Šæ‰‹ä½¿ç”¨çš„ï¼›

- å†…ç½®å‡½æ•°å¾€å¾€æ ¹æ®å‡½æ•°çš„åº”ç”¨åŠŸèƒ½ç±»å‹æ¥åˆ†ç±»
- æ—¥æœŸå‡½æ•°ã€æ•°å­—å‡½æ•°ã€å­—ç¬¦ä¸²å‡½æ•°ã€é›†åˆå‡½æ•°ã€æ¡ä»¶å‡½æ•°....



ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆ==user-defined function==ï¼‰

&gt; ç”¨æˆ·ç¼–ç¨‹å®ç°å‡½æ•°çš„é€»è¾‘åœ¨hiveä¸­ä½¿ç”¨ã€‚

- UDFæ ¹æ®å‡½æ•°==è¾“å…¥è¡Œæ•°å’Œè¾“å‡ºè¡Œæ•°==è¿›è¡Œåˆ†ç±»

- UDF ã€UDAFã€UDTF![7-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°_image-7.png](/img/user/czc%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/9-%E9%99%84%E4%BB%B6/%E9%99%84%E4%BB%B6/7-Apache%20Hive%20SQL%20DQL%E3%80%81%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%87%BD%E6%95%B0_image-7.png)

  {{CODE_BLOCK_22}}



==**UDFåˆ†ç±»æ ‡å‡†çš„æ‰©å¤§åŒ–**==

- æœ¬æ¥ï¼Œudf/udtf/udaf3ä¸ªæ ‡å‡†æ˜¯é’ˆå¯¹ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°åˆ†ç±»çš„ï¼›
- ä½†æ˜¯ï¼Œç°åœ¨å¯ä»¥å°†è¿™ä¸ªåˆ†ç±»æ ‡å‡†æ‰©å¤§åˆ°==hiveä¸­æ‰€æœ‰çš„å‡½æ•°ï¼ŒåŒ…æ‹¬å†…ç½®å‡½æ•°å’Œè‡ªå®šä¹‰å‡½æ•°==ï¼›
- ä¸è¦è¢«UDè¿™ä¸¤ä¸ªå­—æ¯æ‰€å½±å“ã€‚  Built-in Aggregate Functions (UDAF).



å‡½æ•°ç›¸å…³çš„å¸¸ç”¨å¸®åŠ©å‘½ä»¤

{{CODE_BLOCK_23}}

-------

#### çŸ¥è¯†ç‚¹11ï¼šHive SQL--å¸¸ç”¨å†…ç½®å‡½æ•°æ¢³ç†--å­—ç¬¦ä¸²å‡½æ•°

{{CODE_BLOCK_24}}

-----

#### çŸ¥è¯†ç‚¹12ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ—¶é—´æ—¥æœŸã€æ•°å€¼

Date Functions æ—¥æœŸå‡½æ•°

&gt; æ—¥æœŸå’Œæ—¶é—´æˆ³æ•°å­—ä¹‹é—´çš„è½¬æ¢ 
&gt;
&gt; ==unix_timestamp==  æ—¥æœŸè½¬unixæ—¶é—´æˆ³
&gt;
&gt; ==from_unixtime==  unixæ—¶é—´æˆ³è½¬æ—¥æœŸ
&gt;
&gt; ==date_add== 
&gt;
&gt; ==date_sub==  
&gt;
&gt; ==datediff==

{{CODE_BLOCK_25}}

---

Mathematical Functions æ•°å­¦å‡½æ•°

&gt; ==round== å–æ•´
&gt;
&gt; ==rand== å–éšæœºå€¼

{{CODE_BLOCK_26}}

-----

#### çŸ¥è¯†ç‚¹13ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ¡ä»¶è½¬æ¢ã€é›†åˆã€åŠ å¯†

Conditional Functions æ¡ä»¶å‡½æ•°

&gt; ==éƒ½é‡è¦==ã€‚å°¤å…¶æ˜¯case when

{{CODE_BLOCK_27}}

-----

Type Conversion Functions ç±»å‹è½¬æ¢å‡½æ•°

- å‰ç½®çŸ¥è¯†ï¼šHiveä¸­æ”¯æŒç±»å‹çš„éšå¼è½¬æ¢  æœ‰é™åˆ¶  è‡ªåŠ¨è½¬æ¢  ä¸ä¿è¯æˆåŠŸ  å°±æ˜¾ç¤ºnull

- ==castæ˜¾ç¤ºç±»å‹è½¬æ¢å‡½æ•°==

  {{CODE_BLOCK_28}}

----

Data Masking Functions æ•°æ®è„±æ•å‡½æ•°  

&gt; maskè„±æ• æ©ç å¤„ç†
&gt;
&gt; æ•°æ®è„±æ•ï¼š==è®©æ•æ„Ÿæ•°æ®ä¸æ•æ„Ÿ==   13455667788 ---&gt;134****7788

{{CODE_BLOCK_29}}

-----

Misc. Functions å…¶ä»–æ‚é¡¹å‡½æ•°ã€åŠ å¯†å‡½æ•°

{{CODE_BLOCK_30}}



































































</code></pre>
</main>
<aside>
<div class="sidebar">
<div class="sidebar-container">
<div class="toc">
<div class="toc-title-container">
<div class="toc-title">
On this page
</div>
</div>
<div class="toc-container">
<nav class="toc">
<ol>
<li><a href="#hadoop-day07-apache-hive-sql-dql">hadoopç¦»çº¿day07-Apache Hive SQL DQLã€å‚æ•°é…ç½®ä¸å‡½æ•°</a>
<ol>
<li><a href="#ä»Šæ—¥è¯¾ç¨‹å­¦ä¹ ç›®æ ‡">ä»Šæ—¥è¯¾ç¨‹å­¦ä¹ ç›®æ ‡</a>
</li>
<li><a href="#ä»Šæ—¥è¯¾ç¨‹å†…å®¹å¤§çº²">ä»Šæ—¥è¯¾ç¨‹å†…å®¹å¤§çº²</a>
</li>
<li><a href="#01-hive-sql-dql">çŸ¥è¯†ç‚¹01ï¼šHive SQL--DQL--åŸºç¡€æŸ¥è¯¢è¯­å¥åŠå…¶æ³¨æ„äº‹é¡¹</a>
<ol>
<li><a href="#sql">â­â­SQLçš„é‡ç‚¹â­â­</a>
</li>
</ol>
</li>
<li><a href="#02-hive-sql-dql-cluster-distribute-sort">çŸ¥è¯†ç‚¹02ï¼šHive SQL--DQL--é«˜é˜¶æŸ¥è¯¢--clusterã€distributeã€sort</a>
</li>
<li><a href="#03-hive-sql-dql-union">çŸ¥è¯†ç‚¹03ï¼šHive SQL--DQL--é«˜é˜¶æŸ¥è¯¢--Unionè”åˆæŸ¥è¯¢</a>
</li>
<li><a href="#04-hive-sql-dql-cte">çŸ¥è¯†ç‚¹04ï¼šHive SQL--DQL--é«˜é˜¶æŸ¥è¯¢--CTEè¡¨è¾¾å¼</a>
</li>
<li><a href="#05-hive-sql-dql-join-inner-left">çŸ¥è¯†ç‚¹05ï¼šHive SQL--DQL--Joinè¯­æ³•åŠå…¶ä½¿ç”¨ï¼ˆä¾§é‡innerã€leftï¼‰</a>
</li>
<li><a href="#06-hive-sql-dql-join">çŸ¥è¯†ç‚¹06ï¼šHive SQL--DQL--Joinè¯­æ³•æ³¨æ„äº‹é¡¹</a>
</li>
<li><a href="#07-hive-sql">çŸ¥è¯†ç‚¹07ï¼šHive SQL--ç¬¬ä¸€ä»£å®¢æˆ·ç«¯çš„åŠŸèƒ½</a>
</li>
<li><a href="#08-hive-sql">çŸ¥è¯†ç‚¹08ï¼šHive SQL--å‚æ•°é…ç½®æ–¹å¼ä¸ä¼˜å…ˆçº§èŒƒå›´</a>
</li>
<li><a href="#09-hive-sql">çŸ¥è¯†ç‚¹09ï¼šHive SQL--å†…ç½®å¸¸è§è¿ç®—ç¬¦</a>
</li>
<li><a href="#11-hive-sql">çŸ¥è¯†ç‚¹11ï¼šHive SQL--å¸¸ç”¨å†…ç½®å‡½æ•°æ¢³ç†--å­—ç¬¦ä¸²å‡½æ•°</a>
</li>
<li><a href="#12-hive-sql">çŸ¥è¯†ç‚¹12ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ—¶é—´æ—¥æœŸã€æ•°å€¼</a>
</li>
<li><a href="#13-hive-sql">çŸ¥è¯†ç‚¹13ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ¡ä»¶è½¬æ¢ã€é›†åˆã€åŠ å¯†</a>
</li>
<li><a href="#10-hive-sql-udf-udaf-udtf">çŸ¥è¯†ç‚¹10ï¼šHive SQL--å‡½æ•°åŠåˆ†ç±»æ ‡å‡†ï¼ˆUDFã€UDAFã€UDTFï¼‰</a>
</li>
<li><a href="#11-hive-sql-1">çŸ¥è¯†ç‚¹11ï¼šHive SQL--å¸¸ç”¨å†…ç½®å‡½æ•°æ¢³ç†--å­—ç¬¦ä¸²å‡½æ•°</a>
</li>
<li><a href="#12-hive-sql-1">çŸ¥è¯†ç‚¹12ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ—¶é—´æ—¥æœŸã€æ•°å€¼</a>
</li>
<li><a href="#13-hive-sql-1">çŸ¥è¯†ç‚¹13ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ¡ä»¶è½¬æ¢ã€é›†åˆã€åŠ å¯†</a>
</li>
<li><a href="#10-hive-sql-udf-udaf-udtf-1">çŸ¥è¯†ç‚¹10ï¼šHive SQL--å‡½æ•°åŠåˆ†ç±»æ ‡å‡†ï¼ˆUDFã€UDAFã€UDTFï¼‰</a>
</li>
<li><a href="#11-hive-sql-2">çŸ¥è¯†ç‚¹11ï¼šHive SQL--å¸¸ç”¨å†…ç½®å‡½æ•°æ¢³ç†--å­—ç¬¦ä¸²å‡½æ•°</a>
</li>
<li><a href="#12-hive-sql-2">çŸ¥è¯†ç‚¹12ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ—¶é—´æ—¥æœŸã€æ•°å€¼</a>
</li>
<li><a href="#13-hive-sql-2">çŸ¥è¯†ç‚¹13ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ¡ä»¶è½¬æ¢ã€é›†åˆã€åŠ å¯†</a>
</li>
<li><a href="#10-hive-sql-udf-udaf-udtf-2">çŸ¥è¯†ç‚¹10ï¼šHive SQL--å‡½æ•°åŠåˆ†ç±»æ ‡å‡†ï¼ˆUDFã€UDAFã€UDTFï¼‰</a>
</li>
<li><a href="#11-hive-sql-3">çŸ¥è¯†ç‚¹11ï¼šHive SQL--å¸¸ç”¨å†…ç½®å‡½æ•°æ¢³ç†--å­—ç¬¦ä¸²å‡½æ•°</a>
</li>
<li><a href="#12-hive-sql-3">çŸ¥è¯†ç‚¹12ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ—¶é—´æ—¥æœŸã€æ•°å€¼</a>
</li>
<li><a href="#13-hive-sql-3">çŸ¥è¯†ç‚¹13ï¼šHive SQL--å†…ç½®å‡½æ•°æ¢³ç†--æ¡ä»¶è½¬æ¢ã€é›†åˆã€åŠ å¯†</a>
</li>
</ol>
</li>
</ol>
</nav>
</div>
</div>
<div class="backlinks">
<div class="backlink-title" style="margin:4px 0!important">Pages mentioning this page</div>
<div class="backlink-list"><div class="backlink-card"><i icon-name="link"></i><a href="/czcçŸ¥è¯†åº“/è®¡ç®—æœº/HadoopæŠ€æœ¯æ ˆ/HadoopæŠ€æœ¯æ ˆ/" data-note-icon="" class="backlink">HadoopæŠ€æœ¯æ ˆ</a>
</div></div>
</div>
</div>
</div>
</aside>
<style>#tooltip-wrapper{background:var(--background-primary);padding:1em;border-radius:4px;overflow:hidden;position:fixed;width:80%;max-width:400px;height:auto;max-height:300px;font-size:.8em;box-shadow:0 5px 10px rgba(0,0,0,.1);opacity:0;transition:opacity .1s;unicode-bidi:plaintext;overflow-y:scroll;z-index:10}#tooltip-wrapper:after{content:"";position:absolute;z-index:1;bottom:0;left:0;pointer-events:none;width:100%;unicode-bidi:plaintext;height:75px}</style>
<div style="opacity:0;display:none" id="tooltip-wrapper">
<div id="tooltip-content">
</div>
</div>
<iframe style="display:none;height:0;width:0" id="link-preview-iframe" src="">
</iframe>
<script>var opacityTimeout,contentTimeout,transitionDurationMs=100,iframe=document.getElementById("link-preview-iframe"),tooltipWrapper=document.getElementById("tooltip-wrapper"),tooltipContent=document.getElementById("tooltip-content"),linkHistories={};function hideTooltip(){opacityTimeout=setTimeout((function(){tooltipWrapper.style.opacity=0,contentTimeout=setTimeout((function(){tooltipContent.innerHTML="",tooltipWrapper.style.display="none"}),transitionDurationMs+1)}),transitionDurationMs)}function showTooltip(t){var e=t.target,o=e.getClientRects()[e.getClientRects().length-1],i=window.pageYOffset||document.documentElement.scrollTop,n=t.target.getAttribute("href");if(-1===n.indexOf("http")||-1!==n.indexOf(window.location.host)){let t=n.split("#")[0];linkHistories[t]?(tooltipContent.innerHTML=linkHistories[t],tooltipWrapper.style.display="block",setTimeout((function(){if(tooltipWrapper.style.opacity=1,-1!=n.indexOf("#")){let t=n.split("#")[1];const e=tooltipWrapper.querySelector(`[id='${t}']`);e.classList.add("referred"),e.scrollIntoView({behavior:"smooth"},!0)}else tooltipWrapper.scroll(0,0)}),1)):(iframe.src=t,iframe.onload=function(){tooltipContentHtml="",tooltipContentHtml+='<div style="font-weight: bold; unicode-bidi: plaintext;">'+iframe.contentWindow.document.querySelector("h1").innerHTML+"</div>",tooltipContentHtml+=iframe.contentWindow.document.querySelector(".content").innerHTML,tooltipContent.innerHTML=tooltipContentHtml,linkHistories[t]=tooltipContentHtml,tooltipWrapper.style.display="block",tooltipWrapper.scrollTop=0,setTimeout((function(){if(tooltipWrapper.style.opacity=1,-1!=n.indexOf("#")){let t=n.split("#")[1];const e=tooltipWrapper.querySelector(`[id='${t}']`);e.classList.add("referred"),console.log(e),e.scrollIntoView({behavior:"smooth"},!0)}else tooltipWrapper.scroll(0,0)}),1)}),tooltipWrapper.style.left=o.left-tooltipWrapper.offsetWidth/2+o.width/2+"px",window.innerHeight-o.top<tooltipWrapper.offsetHeight?tooltipWrapper.style.top=o.top+i-tooltipWrapper.offsetHeight-10+"px":window.innerHeight-o.top>tooltipWrapper.offsetHeight&&(tooltipWrapper.style.top=o.top+i+35+"px"),o.left+o.width/2<tooltipWrapper.offsetWidth/2?tooltipWrapper.style.left="10px":document.body.clientWidth-o.left-o.width/2<tooltipWrapper.offsetWidth/2&&(tooltipWrapper.style.left=document.body.clientWidth-tooltipWrapper.offsetWidth-20+"px")}}function setupListeners(t){t.addEventListener("mouseleave",(function(t){hideTooltip()})),tooltipWrapper.addEventListener("mouseleave",(function(t){hideTooltip()})),t.addEventListener("mouseenter",(function(t){clearTimeout(opacityTimeout),clearTimeout(contentTimeout),showTooltip(t)})),tooltipWrapper.addEventListener("mouseenter",(function(t){clearTimeout(opacityTimeout),clearTimeout(contentTimeout)}))}window.addEventListener("load",(function(t){document.querySelectorAll(".internal-link").forEach(setupListeners),document.querySelectorAll(".backlink-card a").forEach(setupListeners)}))</script>
<script>window.location.hash&&document.getElementById(window.location.hash.slice(1)).classList.add("referred"),window.addEventListener("hashchange",(e=>{const t=e.oldURL.split("#");t[1]&&document.getElementById(t[1]).classList.remove("referred");const n=e.newURL.split("#");n[1]&&document.getElementById(n[1]).classList.add("referred")}),!1);const url_parts=window.location.href.split("#"),url=url_parts[0],referrence=url_parts[1];document.querySelectorAll(".cm-s-obsidian > *[id]").forEach((function(e){e.ondblclick=function(e){const t=url+"#"+e.target.id;navigator.clipboard.writeText(t)}}))</script>
<script src="https://fastly.jsdelivr.net/npm/luxon@3.2.1/build/global/luxon.min.js"></script>
<script defer="defer">TIMESTAMP_FORMAT="MMM dd, yyyy h:mm a",document.querySelectorAll(".human-date").forEach((function(e){date=e.getAttribute("data-date")||e.innerText,parsed_date=luxon.DateTime.fromISO(date),null!=parsed_date.invalid&&(parsed_date=luxon.DateTime.fromSQL(date)),null!=parsed_date.invalid&&(parsed_date=luxon.DateTime.fromHTML(date)),e.innerHTML=parsed_date.toFormat(TIMESTAMP_FORMAT)}))</script>
<script>lucide.createIcons({attrs:{class:["svg-icon"]}})</script>
</body>
</html>
